!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PUBNUB=t():e.PUBNUB=t()}(this,function(){return function(n){var i={};function r(e){if(i[e])return i[e].exports;var t=i[e]={exports:{},id:e,loaded:!1};return n[e].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}return r.m=n,r.c=i,r.p="",r(0)}([function(e,t,n){n(1);var s=n(2),i=n(3),l=n(4),o=n(8);window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var a=function(){var i={},e=!1;try{e=window.localStorage}catch(e){return}var n=function(e){return-1===document.cookie.indexOf(e)?null:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||null},r=function(e,t){document.cookie=e+"="+t+"; expires=Thu, 1 Aug "+((new Date).getFullYear()+1)+" 20:00:00 UTC; path=/"},s=function(){try{return r("pnctest","1"),"1"===n("pnctest")}catch(e){return!1}}();return{get:function(t){try{return e?e.getItem(t):s?n(t):i[t]}catch(e){return i[t]}},set:function(t,n){try{if(e)return e.setItem(t,n)&&0;s&&r(t,n),i[t]=n}catch(e){i[t]=n}}}}();function c(e,t){return i.HmacSHA256(e,t).toString(i.enc.Base64)}function u(e){return document.getElementById(e)}function h(e){console.error(e)}function f(e,t){var n=[];return l.each(e.split(/\s+/),function(e){l.each((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n}function p(e,n,i){l.each(e.split(","),function(e){var t=function(e){e||(e=window.event),i(e)||(e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};n.addEventListener?n.addEventListener(e,t,!1):n.attachEvent?n.attachEvent("on"+e,t):n["on"+e]=t})}function d(){return f("head")[0]}function g(e,t,n){if(!n)return e&&e.getAttribute&&e.getAttribute(t);e.setAttribute(t,n)}function y(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+(0<"|width|height|top|left|".indexOf(n)&&"number"==typeof t[n]?"px":"")}catch(e){return}}function m(e){return document.createElement(e)}var v={list:{},unbind:function(e){v.list[e]=[]},bind:function(e,t){(v.list[e]=v.list[e]||[]).push(t)},fire:function(e,t){l.each(v.list[e]||[],function(e){e(t)})}};function b(e){var n,i,r=0,t=0,s=e.timeout||l.DEF_TIMEOUT,o=e.data||{},a=e.fail||function(){},c=e.success||function(){},u=function(e,t){r||(r=1,clearTimeout(i),n&&(n.onerror=n.onload=null,n.abort&&n.abort(),n=null),e&&a(t))};i=l.timeout(function(){u(1)},s);try{(n="undefined"!=typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest).onerror=n.onabort=function(){u(1,n.responseText||{error:"Network Connection Error"})},n.onload=n.onloadend=function(){if(!t){var e;t=1,clearTimeout(i);try{e=JSON.parse(n.responseText)}catch(e){return u(1)}c(e)}};var h=l.build_url(e.url,o);n.open("GET",h,!0),n.timeout=s,n.send()}catch(e){u(1,{error:"XHR Failed",stacktrace:e})}return u}function w(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function S(e){return"sendBeacon"in navigator&&navigator.sendBeacon(e)}var _=function(e){var t=e.leave_on_unload||0;e.xdr=b,e.db=a,e.error=e.error||h,e._is_online=w,e.hmac_SHA256=c,e.crypto_obj=s(),e.sendBeacon=S,e.sdk_family="Web";var n=function(e){return _(e)},i=l.PN_API(e);for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);return n.css=y,n.$=u,n.create=m,n.bind=p,n.head=d,n.search=f,n.attr=g,n.events=v,((n.init=n).secure=n).crypto_obj=s(),n.WS=o,n.PNmessage=l.PNmessage,n.supplant=l.supplant,p("beforeunload",window,function(){return t&&n["each-channel"](function(e){n.LEAVE(e.name,0)}),!0}),n.ready(),e.notest||(p("offline",window,n.offline),p("offline",document,n.offline)),n};((_.init=_).secure=_).crypto_obj=s(),_.WS=o,_.db=a,_.PNmessage=l.PNmessage,_.uuid=l.uuid,_.css=y,_.$=u,_.create=u,_.bind=p,_.head=d,_.search=f,_.attr=g,_.events=v,_.map=l.map,_.each=l.each,_.grep=l.grep,_.supplant=l.supplant,_.now=l.now,_.unique=l.unique,_.updater=l.updater,window.jQuery&&(window.jQuery.PUBNUB=_),e.exports=_},function(module,exports){(function(){window.JSON&&window.JSON.stringify||function(){function toJSON(e){try{return this.valueOf()}catch(e){return null}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,s,o,a=gap,c=t[e];switch(c&&"object"==typeof c&&(c=toJSON.call(c,e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,n=0;n<s;n+=1)o[n]=str(n,c)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;n<s;n+=1)"string"==typeof(i=rep[n])&&(r=str(i,c))&&o.push(quote(i)+(gap?": ":":")+r);else for(i in c)Object.hasOwnProperty.call(c,i)&&(r=str(i,c))&&o.push(quote(i)+(gap?": ":":")+r);return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(indent=gap="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}()}).call(window)},function(e,t,n){var f=n(3);e.exports=function(){var t=["hex","utf8","base64","binary"],n=[128,256],i=["ecb","cbc"],r=!0,s="utf8",o=256,a="cbc";function c(e){return(e=e||{}).hasOwnProperty("encryptKey")||(e.encryptKey=r),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=s),e.hasOwnProperty("keyLength")||(e.keyLength=o),e.hasOwnProperty("mode")||(e.mode=a),-1==t.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=s),-1==n.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=o),-1==i.indexOf(e.mode.toLowerCase())&&(e.mode=a),e}function u(e,t){var n,i,r;return n=e,e="base64"===(i=t).keyEncoding?f.enc.Base64.parse(n):"hex"===i.keyEncoding?f.enc.Hex.parse(n):n,t.encryptKey?f.enc.Utf8.parse((r=e,f.SHA256(r).toString(f.enc.Hex)).slice(0,32)):e}function h(e){return"ecb"===e.mode?f.mode.ECB:f.mode.CBC}function l(e){return"cbc"===e.mode?f.enc.Utf8.parse("0123456789012345"):null}return{encrypt:function(e,t,n){if(!t)return e;var i=l(n=c(n)),r=h(n),s=u(t,n),o=JSON.stringify(e);return f.AES.encrypt(o,s,{iv:i,mode:r}).ciphertext.toString(f.enc.Base64)||e},decrypt:function(e,t,n){if(!t)return e;var i=l(n=c(n)),r=h(n),s=u(t,n);try{var o=f.enc.Base64.parse(e),a=f.AES.decrypt({ciphertext:o},s,{iv:i,mode:r}).toString(f.enc.Utf8);return JSON.parse(a)}catch(e){return}}}}},function(e,t){var n,u,i,c,r,s,o,h,a,l,B=B||function(a,e){var t={},n=t.lib={},i=function(){},r=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,r=this.blockSize,s=i/(4*r);if(e=(s=e?a.ceil(s):a.max((0|s)-this._minBufferSize,0))*r,i=a.min(4*e,i),e){for(var o=0;o<e;o+=r)this._doProcessBlock(n,o);o=n.splice(0,e),t.sigBytes-=i}return new c.init(o,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new f.HMAC.init(n,t).finalize(e)}}});var f=t.algo={};return t}(Math);!function(r){for(var e=B,t=(i=e.lib).WordArray,n=i.Hasher,i=e.algo,s=[],d=[],o=function(e){return 4294967296*(e-(0|e))|0},a=2,c=0;c<64;){var u;e:{u=a;for(var h=r.sqrt(u),l=2;l<=h;l++)if(!(u%l)){u=!1;break e}u=!0}u&&(c<8&&(s[c]=o(r.pow(a,.5))),d[c]=o(r.pow(a,1/3)),c++),a++}var g=[];i=i.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],u=n[6],h=n[7],l=0;l<64;l++){if(l<16)g[l]=0|e[t+l];else{var f=g[l-15],p=g[l-2];g[l]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+g[l-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+g[l-16]}f=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+d[l]+g[l],p=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),h=u,u=c,c=a,a=o+f|0,o=s,s=r,r=i,i=f+p|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=r.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=n._createHelper(i),e.HmacSHA256=n._createHmacHelper(i)}(Math),u=(n=B).enc.Utf8,n.algo.HMAC=n.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),s=this._iKey=t.clone(),o=r.words,a=s.words,c=0;c<n;c++)o[c]^=1549556828,a[c]^=909522486;r.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),c=(i=B).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;o<4&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return c.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(s){function I(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function x(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function C(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function E(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var e=B,t=(i=e.lib).WordArray,n=i.Hasher,i=e.algo,k=[],r=0;r<64;r++)k[r]=4294967296*s.abs(s.sin(r+1))|0;i=i.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=e[o=t+n];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}n=this._hash.words;var r,s,o=e[t+0],a=(i=e[t+1],e[t+2]),c=e[t+3],u=e[t+4],h=e[t+5],l=e[t+6],f=e[t+7],p=e[t+8],d=e[t+9],g=e[t+10],y=e[t+11],m=e[t+12],v=e[t+13],b=e[t+14],w=e[t+15],S=n[0],_=E(_=E(_=E(_=E(_=C(_=C(_=C(_=C(_=x(_=x(_=x(_=x(_=I(_=I(_=I(_=I(_=n[1],s=I(s=n[2],r=I(r=n[3],S=I(S,_,s,r,o,7,k[0]),_,s,i,12,k[1]),S,_,a,17,k[2]),r,S,c,22,k[3]),s=I(s,r=I(r,S=I(S,_,s,r,u,7,k[4]),_,s,h,12,k[5]),S,_,l,17,k[6]),r,S,f,22,k[7]),s=I(s,r=I(r,S=I(S,_,s,r,p,7,k[8]),_,s,d,12,k[9]),S,_,g,17,k[10]),r,S,y,22,k[11]),s=I(s,r=I(r,S=I(S,_,s,r,m,7,k[12]),_,s,v,12,k[13]),S,_,b,17,k[14]),r,S,w,22,k[15]),s=x(s,r=x(r,S=x(S,_,s,r,i,5,k[16]),_,s,l,9,k[17]),S,_,y,14,k[18]),r,S,o,20,k[19]),s=x(s,r=x(r,S=x(S,_,s,r,h,5,k[20]),_,s,g,9,k[21]),S,_,w,14,k[22]),r,S,u,20,k[23]),s=x(s,r=x(r,S=x(S,_,s,r,d,5,k[24]),_,s,b,9,k[25]),S,_,c,14,k[26]),r,S,p,20,k[27]),s=x(s,r=x(r,S=x(S,_,s,r,v,5,k[28]),_,s,a,9,k[29]),S,_,f,14,k[30]),r,S,m,20,k[31]),s=C(s,r=C(r,S=C(S,_,s,r,h,4,k[32]),_,s,p,11,k[33]),S,_,y,16,k[34]),r,S,b,23,k[35]),s=C(s,r=C(r,S=C(S,_,s,r,i,4,k[36]),_,s,u,11,k[37]),S,_,f,16,k[38]),r,S,g,23,k[39]),s=C(s,r=C(r,S=C(S,_,s,r,v,4,k[40]),_,s,o,11,k[41]),S,_,c,16,k[42]),r,S,l,23,k[43]),s=C(s,r=C(r,S=C(S,_,s,r,d,4,k[44]),_,s,m,11,k[45]),S,_,w,16,k[46]),r,S,a,23,k[47]),s=E(s,r=E(r,S=E(S,_,s,r,o,6,k[48]),_,s,f,10,k[49]),S,_,b,15,k[50]),r,S,h,21,k[51]),s=E(s,r=E(r,S=E(S,_,s,r,m,6,k[52]),_,s,c,10,k[53]),S,_,g,15,k[54]),r,S,i,21,k[55]),s=E(s,r=E(r,S=E(S,_,s,r,p,6,k[56]),_,s,w,10,k[57]),S,_,l,15,k[58]),r,S,v,21,k[59]),s=E(s,r=E(r,S=E(S,_,s,r,u,6,k[60]),_,s,y,10,k[61]),S,_,a,15,k[62]),r,S,d,21,k[63]);n[0]=n[0]+S|0,n[1]=n[1]+_|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32;var r=s.floor(n/4294967296);for(t[15+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)i=t[n],t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(i),e.HmacMD5=n._createHmacHelper(i)}(Math),o=(r=(s=B).lib).Base,h=r.WordArray,a=(r=s.algo).EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:r.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(o=this.cfg).hasher.create(),i=h.create(),r=i.words,s=o.keySize,o=o.iterations;r.length<s;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<o;c++)a=n.finalize(a),n.reset();i.concat(a)}return i.sigBytes=4*s,i}}),s.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)},B.lib.Cipher||function(e){var t=(p=B).lib,n=t.Base,o=t.WordArray,i=t.BufferedBlockAlgorithm,r=p.enc.Base64,s=p.algo.EvpKDF,a=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(i){return{encrypt:function(e,t,n){return("string"==typeof t?d:f).encrypt(i,e,t,n)},decrypt:function(e,t,n){return("string"==typeof t?d:f).decrypt(i,e,t,n)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},u=function(e,t,n){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=i[r]},h=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;u.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=e.slice(t,t+i);n.decryptBlock(e,t),u.call(this,e,t,i),this._prevBlock=r}}),c=c.CBC=h,h=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,r=[],s=0;s<n;s+=4)r.push(i);n=o.create(r,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:h}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(r)},parse:function(e){var t=(e=r.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i);return t=r.finalize(t),r=r.cfg,l.create({ciphertext:t,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=o.random(8)),e=s.create({keySize:t+n}).compute(e,i),n=o.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:i})}},d=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,n,i){return n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,(e=f.encrypt.call(this,e,t,n.key,i)).mixIn(n),e},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt),i.iv=n.iv,f.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=B,t=e.lib.BlockCipher,n=e.algo,o=[],i=[],r=[],s=[],a=[],c=[],u=[],h=[],l=[],f=[],p=[],d=0;d<256;d++)p[d]=d<128?d<<1:d<<1^283;var g=0,y=0;for(d=0;d<256;d++){var m=(m=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&m^99;o[g]=m;var v=p[i[m]=g],b=p[v],w=p[b],S=257*p[m]^16843008*m;r[g]=S<<24|S>>>8,s[g]=S<<16|S>>>16,a[g]=S<<8|S>>>24,c[g]=S,S=16843009*w^65537*b^257*v^16843008*g,u[m]=S<<24|S>>>8,h[m]=S<<16|S>>>16,l[m]=S<<8|S>>>24,f[m]=S,g?(g=v^p[p[p[w^v]]],y^=p[p[y]]):g=y=1}var _=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],r=0;r<n;r++)if(r<t)i[r]=e[r];else{var s=i[r-1];r%t?6<t&&4==r%t&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=_[r/t|0]<<24),i[r]=i[r-t]^s}for(e=this._invKeySchedule=[],t=0;t<n;t++)r=n-t,s=t%4?i[r]:i[r-4],e[t]=t<4||r<=4?s:u[o[s>>>24]]^h[o[s>>>16&255]]^l[o[s>>>8&255]]^f[o[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,s,a,c,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,h,l,f,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,s,o,a){for(var c=this._nRounds,u=e[t]^n[0],h=e[t+1]^n[1],l=e[t+2]^n[2],f=e[t+3]^n[3],p=4,d=1;d<c;d++){var g=i[u>>>24]^r[h>>>16&255]^s[l>>>8&255]^o[255&f]^n[p++],y=i[h>>>24]^r[l>>>16&255]^s[f>>>8&255]^o[255&u]^n[p++],m=i[l>>>24]^r[f>>>16&255]^s[u>>>8&255]^o[255&h]^n[p++];f=i[f>>>24]^r[u>>>16&255]^s[h>>>8&255]^o[255&l]^n[p++],u=g,h=y,l=m}g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&f])^n[p++],y=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^n[p++],m=(a[l>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[p++],f=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[p++],e[t]=g,e[t+1]=y,e[t+2]=m,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),B.mode.ECB=((l=B.lib.BlockCipherMode.extend()).Encryptor=l.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),l.Decryptor=l.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),l),e.exports=B},function(e,t,n){var i=n(5),r=n(6),de=n(7),s=1,ge=!1,ye=[],me="-pnpres",ve=1e3,be=i.version;function we(){return"x"+ ++s+ +new Date}var o,Se=(o=Math.floor(20*Math.random()),function(e){var t=e.split("://")[0],n=e.split("://")[1];return n.match("^ps")?t+"://"+n.replace("ps","ps"+(++o<20?o:o=1)):n.match("^pubsub")?t+"://"+n.replace("pubsub","ps"+(++o<20?o:o=1)):e});function _e(e,n){var i=[];return de.each(e,function(e,t){n?e.search("-pnpres")<0&&t.subscribed&&i.push(e):t.subscribed&&i.push(e)}),i.sort()}function Ie(e,n){var i=[];return de.each(e,function(e,t){n?e.search("-pnpres")<0&&t.subscribed&&i.push(e):t.subscribed&&i.push(e)}),i.sort()}function xe(){ge||(ge=1,de.each(ye,function(e){e()}))}e.exports={PN_API:function(e){var n,i,S=+e.windowing||10,_=(+e.timeout||310)*ve,r=(+e.keepalive||60)*ve,s=e.timecheck||0,f=e.noleave||0,g=e.publish_key,I=e.subscribe_key,x=e.auth_key||"",p=e.secret_key||"",a=e.hmac_SHA256,d=e.ssl?"s":"",C="http"+d+"://"+(e.origin||"pubsub.pubnub.com"),E=Se(C),k=Se(C),B=function(){},y=[],l=!0,M=0,T=0,O=0,A=0,P=e.restore||0,N=0,j=!1,D={},R={},L={},t=null,U=Z(e.heartbeat||e.pnexpires||0,e.error),o=e.heartbeat_interval||U/2-1,c=!1,u=e.no_wait_for_pending,m=e["compatible_3.5"]||!1,h=e.xdr,v=e.params||{},H=e.error||function(){},b=e._is_online||function(){return 1},z=e.jsonp_cb||function(){return 0},F=e.db||{get:function(){},set:function(){}},w=e.cipher_key,G=e.uuid||!e.unique_uuid&&F&&F.get(I+"uuid")||"",J=e.instance_id||!1,K=e.partner_id,W=e.sdk_family,V="",X=e.shutdown,q=void 0===e.use_send_beacon||e.use_send_beacon?e.sendBeacon:null;2===U&&(o=1);var Q=e.crypto_obj||{encrypt:function(e,t){return e},decrypt:function(e,t){return e}};function $(n){var e;return n||(n={}),de.each(v,function(e,t){e in n||(n[e]=t)}),n.pnsdk=(e="PubNub-JS-"+W,K&&(e+="-"+K),e+="/"+be),n}function Y(e){return(t=e,n=[],de.each(t,function(e,t){n.push(e)}),n).sort();var t,n}function Z(e,t,n){var i=!1;if(void 0===e)return t;if("number"==typeof e)i=!(5<e||0==e);else{if("boolean"==typeof e)return e?30:0;i=!0}return i?(n&&n("Presence Heartbeat value invalid. Valid range ( x > 5 or x = 0). Current Value : "+(t||5)),t||5):e}function ee(e,t){return Q.encrypt(e,t||w)||e}function te(e,t){return Q.decrypt(e,t||w)||Q.decrypt(e,w)||e}function ne(){clearTimeout(t),!o||500<=o||o<1||!_e(D,!0).length&&!Ie(R,!0).length?c=!1:(c=!0,le.presence_heartbeat({callback:function(e){t=de.timeout(ne,o*ve)},error:function(e){H&&H("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),t=de.timeout(ne,o*ve)}}))}function ie(){!c&&ne()}function re(e){if(u){if(!y.length)return}else{if(e&&(y.sending=0),y.sending||!y.length)return;y.sending=1}ue(y.shift())}function se(n){var i=0;return de.each(Ie(R),function(e){var t=R[e];t&&(i++,(n||function(){})(t))}),i}function oe(n){var i=0;return de.each(_e(D),function(e){var t=D[e];t&&(i++,(n||function(){})(t))}),i}function ae(e,t,n){if("object"==typeof e){if(e.error){var i={};return e.message&&(i.message=e.message),e.payload&&(i.payload=e.payload),void(n&&n(i))}if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}function ce(e,t){if("object"==typeof e&&e.error){var n={};return e.message&&(n.message=e.message),e.payload&&(n.payload=e.payload),void(t&&t(n))}t&&t(e)}function ue(e){var t=e.operation,n=Math.floor((new Date).getTime()/1e3),i=e.data||{};if(p){i.auth||delete i.auth,i.timestamp=n;var r=I+"\n"+g+"\n";if("PNAccessManagerGrant"===t)r+="grant\n";else if("PNAccessManagerAudit"===t)r+="audit\n";else{var s=e.url.slice();s.shift(),r+="/"+s.join("/")+"\n"}r+=function(e){var t="",n=Y(e);for(var i in n){var r=n[i];t+=r+"="+de.pamEncode(e[r]),i!=n.length-1&&(t+="&")}return t}(i);var o=a(r,p);o=(o=o.replace(/\+/g,"-")).replace(/\//g,"_"),i.signature=o,e.data=i}return h(e)}function he(e,t,n,i){t=e.callback||t;var r=e.error||H,s=z();(i=i||{}).auth||(i.auth=e.auth_key||x);var o=[E,"v1","channel-registration","sub-key",I];o.push.apply(o,n),s&&(i.callback=s),ue({callback:s,data:$(i),success:function(e){ae(e,t,r)},fail:function(e){ce(e,r)},url:o})}var le={LEAVE:function(e,t,n,i,r){var s,o,a={uuid:G,auth:n||x},c=Se(C),u=(i=i||function(){},r||function(){}),h=z();if(0<e.indexOf(me))return!0;if(m){if(!d)return!1;if("0"==h)return!1}if(f)return!1;if("0"!=h&&(a.callback=h),J&&(a.instanceid=V),s=[c,"v2","presence","sub_key",I,"channel",de.encode(e),"leave"],o=$(a),q){var l=de.buildURL(s,o);if(q(l))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return ue({blocking:t||d,callback:h,data:o,success:function(e){ae(e,i,u)},fail:function(e){ce(e,u)},url:s}),!0},LEAVE_GROUP:function(e,t,n,i,r){var s,o,a={uuid:G,auth:n||x},c=Se(C),u=(i=i||function(){},r||function(){}),h=z();if(0<e.indexOf(me))return!0;if(m){if(!d)return!1;if("0"==h)return!1}if(f)return!1;if("0"!=h&&(a.callback=h),e&&0<e.length&&(a["channel-group"]=e),J&&(a.instanceid=V),s=[c,"v2","presence","sub_key",I,"channel",de.encode(","),"leave"],o=$(a),q){var l=de.buildURL(s,o);if(q(l))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return ue({blocking:t||d,callback:h,data:o,success:function(e){ae(e,i,u)},fail:function(e){ce(e,u)},url:s}),!0},set_resumed:function(e){j=e},get_cipher_key:function(){return w},set_cipher_key:function(e){w=e},raw_encrypt:function(e,t){return ee(e,t)},raw_decrypt:function(e,t){return te(e,t)},get_heartbeat:function(){return U},set_heartbeat:function(e,t){U=Z(e,U,H),o=t||U/2-1,2==U&&(o=1),B(),ne()},get_heartbeat_interval:function(){return o},set_heartbeat_interval:function(e){o=e,ne()},get_version:function(){return be},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var t={aps:{badge:1,alert:""}};for(var n in e)n[t]=e[n];return t},_add_param:function(e,t){v[e]=t},channel_group:function(e,t){var n,i,r=e.channel_group,s=(t=t||e.callback,e.channels||e.channel),o=e.cloak,a=[],c={},u=e.mode||"add";if(r){var h=r.split(":");1<h.length?(n="*"===h[0]?null:h[0],i=h[1]):i=h[0]}n&&a.push("namespace")&&a.push(de.encode(n)),a.push("channel-group"),i&&"*"!==i&&a.push(i),s?(de.isArray(s)&&(s=s.join(",")),c[u]=s,c.cloak=l?"true":"false"):"remove"===u&&a.push("remove"),void 0!==o&&(c.cloak=o?"true":"false"),he(e,t,a,c)},channel_group_list_groups:function(e,t){var n;(n=e.namespace||e.ns||e.channel_group||null)&&(e.channel_group=n+":*"),le.channel_group(e,t)},channel_group_list_channels:function(e,t){if(!e.channel_group)return H("Missing Channel Group");le.channel_group(e,t)},channel_group_remove_channel:function(e,t){return e.channel_group?e.channel||e.channels?(e.mode="remove",void le.channel_group(e,t)):H("Missing Channel"):H("Missing Channel Group")},channel_group_remove_group:function(e,t){return e.channel_group?e.channel?H("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void le.channel_group(e,t)):H("Missing Channel Group")},channel_group_add_channel:function(e,t){return e.channel_group?e.channel||e.channels?void le.channel_group(e,t):H("Missing Channel"):H("Missing Channel Group")},channel_group_cloak:function(e,t){void 0!==e.cloak?(l=e.cloak,le.channel_group(e,t)):t(l)},channel_group_list_namespaces:function(e,t){he(e,t,["namespace"])},channel_group_remove_namespace:function(e,t){he(e,t,["namespace",e.namespace,"remove"])},history:function(e,o){o=e.callback||o;var t=e.count||e.limit||100,n=e.reverse||"false",a=e.error||function(){},i=e.auth_key||x,c=e.cipher_key,r=e.channel,s=e.channel_group,u=e.start,h=e.end,l=e.include_token,f=e.string_message_token||!1,p={},d=z();return r||s?o?I?(p.stringtoken="true",p.count=t,p.reverse=n,p.auth=i,s&&(p["channel-group"]=s,r||(r=",")),d&&(p.callback=d),u&&(p.start=u),h&&(p.end=h),l&&(p.include_token="true"),f&&(p.string_message_token="true"),void ue({callback:d,data:$(p),success:function(e){if("object"==typeof e&&e.error)a({message:e.message,payload:e.payload});else{for(var t=e[0],n=[],i=0;i<t.length;i++)if(l){var r=te(t[i].message,c),s=t[i].timetoken;try{n.push({message:JSON.parse(r),timetoken:s})}catch(e){n.push({message:r,timetoken:s})}}else{r=te(t[i],c);try{n.push(JSON.parse(r))}catch(e){n.push(r)}}o([n,e[1],e[2]])}},fail:function(e){ce(e,a)},url:[E,"v2","history","sub-key",I,"channel",de.encode(r)]})):H("Missing Subscribe Key"):H("Missing Callback"):H("Missing Channel")},replay:function(e,t){t=t||e.callback||function(){};var n=e.auth_key||x,i=e.source,r=e.destination,s=e.error||e.error||function(){},o=e.stop,a=e.start,c=e.end,u=e.reverse,h=e.limit,l=z(),f={};return i?r?g?I?("0"!=l&&(f.callback=l),o&&(f.stop="all"),u&&(f.reverse="true"),a&&(f.start=a),c&&(f.end=c),h&&(f.count=h),f.auth=n,void ue({callback:l,success:function(e){ae(e,t,s)},fail:function(){t([0,"Disconnected"])},url:[E,"v1","replay",g,I,i,r],data:$(f)})):H("Missing Subscribe Key"):H("Missing Publish Key"):H("Missing Destination Channel"):H("Missing Source Channel")},auth:function(e){x=e,B()},time:function(t){var e=z(),n={uuid:G,auth:x};J&&(n.instanceid=V),ue({callback:e,data:$(n),url:[E,"time",e],success:function(e){t(e[0])},fail:function(){t(0)}})},publish:function(e,t){var n=e.message;if(!n)return H("Missing Message");t=t||e.callback||n.callback||e.success||function(){};var i,r,s=e.channel||n.channel,o=e.meta||e.metadata,a=e.auth_key||x,c=e.cipher_key,u=e.error||n.error||function(){},h=e.post||!1,l=!("store_in_history"in e)||e.store_in_history,f=!("replicate"in e)||e.replicate,p=z(),d="push";return e.prepend&&(d="unshift"),s?g?I?(n.getPubnubMessage&&(n=n.getPubnubMessage()),n=JSON.stringify(ee(n,c)),r=[E,"publish",g,I,0,de.encode(s),p,de.encode(n)],i={uuid:G,auth:a},o&&"object"==typeof o&&(i.meta=JSON.stringify(o)),l||(i.store="0"),f||(i.norep="true"),J&&(i.instanceid=V),y[d]({callback:p,url:r,data:$(i),fail:function(e){ce(e,u),re(1)},success:function(e){ae(e,t,u),re(1)},mode:h?"POST":"GET"}),void re()):H("Missing Subscribe Key"):H("Missing Publish Key"):H("Missing Channel")},fire:function(e,t){e.store_in_history=!1,e.replicate=!1,le.publish(e,t)},unsubscribe:function(e,t){var n=e.channel,i=e.channel_group,r=e.auth_key||x,s=(t=t||e.callback||function(){},e.error||function(){});if(!n&&!i)return H("Missing Channel or Channel Group");if(!I)return H("Missing Subscribe Key");if(n){var o=de.isArray(n)?n:(""+n).split(","),a=[],c=[];if(de.each(o,function(e){D[e]&&a.push(e)}),0==a.length)return void t({action:"leave"});de.each(a,function(e){c.push(e+me)}),de.each(a.concat(c),function(e){e in D&&delete D[e],e in L&&delete L[e]}),0===D.length&&0===R.length&&(N=0);var u=!0;ge&&(u=le.LEAVE(a.join(","),0,r,t,s)),u||t({action:"leave"})}if(i){var h=de.isArray(i)?i:(""+i).split(","),l=[],f=[];if(de.each(h,function(e){R[e]&&l.push(e)}),0==l.length)return void t({action:"leave"});de.each(l,function(e){f.push(e+me)}),de.each(l.concat(f),function(e){e in R&&delete R[e],e in L&&delete L[e]}),0===D.length&&0===R.length&&(N=0),u=!0,ge&&(u=le.LEAVE_GROUP(l.join(","),0,r,t,s)),u||t({action:"leave"})}B()},subscribe:function(t,i){var e=t.channel,n=t.channel_group,r=(i=(i=i||t.callback)||t.message,t.connect||function(){}),s=t.reconnect||function(){},o=t.disconnect||function(){},a=t.error||a||function(){},c=t.idle||function(){},u=t.presence||0,h=t.noheresync||0,l=t.backfill||0,f=t.timetoken||0,p=t.timeout||_,d=t.windowing||S,g=t.state,y=t.heartbeat||t.pnexpires,m=t.heartbeat_interval,v=t.restore||P;if(x=t.auth_key||x,P=v,N=f,!e&&!n)return H("Missing Channel");if(!i)return H("Missing Callback");if(!I)return H("Missing Subscribe Key");function b(t){t?de.timeout(B,d):(E=Se(C),k=Se(C),de.timeout(function(){le.time(b)},ve)),oe(function(e){if(t&&e.disconnected)return e.disconnected=0,e.reconnect(e.name);t||e.disconnected||(e.disconnected=1,e.disconnect(e.name))}),se(function(e){if(t&&e.disconnected)return e.disconnected=0,e.reconnect(e.name);t||e.disconnected||(e.disconnected=1,e.disconnect(e.name))})}function w(){var e=z(),t=_e(D).join(","),n=Ie(R).join(",");if(t||n){t||(t=","),fe();var i=$({uuid:G,auth:x});n&&(i["channel-group"]=n),2<JSON.stringify(L).length&&(i.state=JSON.stringify(L)),U&&(i.heartbeat=U),J&&(i.instanceid=V),ie(),A=ue({timeout:p,callback:e,fail:function(t){t&&t.error&&t.service?(ce(t,a),b(!1)):le.time(function(e){!e&&ce(t,a),b(e)})},data:$(i),url:[k,"subscribe",I,de.encode(t),e,N],success:function(i){if(!i||"object"==typeof i&&"error"in i&&i.error)return a(i),de.timeout(B,ve);if(c(i[1]),N=!N&&P&&F.get(I)||i[1],oe(function(e){e.connected||(e.connected=1,e.connect(e.name))}),se(function(e){e.connected||(e.connected=1,e.connect(e.name))}),j&&!P)return N=0,j=!1,F.set(I,0),void de.timeout(w,d);l&&(N=1e4,l=0),F.set(I,i[1]);var e,r=function(){var e="",t="";3<i.length?(e=i[3],t=i[2]):e=2<i.length?i[2]:de.map(_e(D),function(e){return de.map(Array(i[0].length).join(",").split(","),function(){return e})}).join(",");var s=e.split(","),o=t?t.split(","):[];return function(){var e=s.shift()||O,t=o.shift(),n={},i={callback:function(){}};t?(e&&0<=e.indexOf("-pnpres")&&t.indexOf("-pnpres")<0&&(t+="-pnpres"),n=R[t]||D[t]||i):n=D[e]||i;var r=[n.callback||T,e.split(me)[0]];return t&&r.push(t.split(me)[0]),r}}(),s=(e=+i[1],de.rnow()-M-e/1e4);de.each(i[0],function(e){var t=r(),n=te(e,D[t[1]]?D[t[1]].cipher_key:null);t[0]&&t[0](n,i,t[2]||t[1],s,t[1])}),de.timeout(w,d)}})}}if((y||0===y||m||0===m)&&le.set_heartbeat(y,m),e&&de.each((e.join?e.join(","):""+e).split(","),function(n){var e=D[n]||{};D[O=n]={name:n,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:T=i,cipher_key:t.cipher_key,connect:r,disconnect:o,reconnect:s},g&&(L[n]=n in g?g[n]:g),u&&(le.subscribe({channel:n+me,callback:u,restore:v}),e.subscribed||h||le.here_now({channel:n,data:$({uuid:G,auth:x}),callback:function(t){de.each("uuids"in t?t.uuids:[],function(e){u({action:"join",uuid:e,timestamp:Math.floor(de.rnow()/1e3),occupancy:t.occupancy||1},t,n)})}}))}),n&&de.each((n.join?n.join(","):""+n).split(","),function(n){var e=R[n]||{};R[n]={name:n,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:T=i,cipher_key:t.cipher_key,connect:r,disconnect:o,reconnect:s},u&&(le.subscribe({channel_group:n+me,callback:u,restore:v,auth_key:x}),e.subscribed||h||le.here_now({channel_group:n,data:$({uuid:G,auth:x}),callback:function(t){de.each("uuids"in t?t.uuids:[],function(e){u({action:"join",uuid:e,timestamp:Math.floor(de.rnow()/1e3),occupancy:t.occupancy||1},t,n)})}}))}),B=function(){fe(),de.timeout(w,d)},!ge)return ye.push(B);B()},here_now:function(e,t){t=e.callback||t;var n=e.debug,i=e.error||function(){},r=e.auth_key||x,s=e.channel,o=e.channel_group,a=z(),c=!("uuids"in e)||e.uuids,u=e.state,h={uuid:G,auth:r};if(c||(h.disable_uuids=1),u&&(h.state=1),!t)return H("Missing Callback");if(!I)return H("Missing Subscribe Key");var l=[E,"v2","presence","sub_key",I];s&&l.push("channel")&&l.push(de.encode(s)),"0"!=a&&(h.callback=a),o&&(h["channel-group"]=o,!s&&l.push("channel")&&l.push(",")),J&&(h.instanceid=V),ue({callback:a,data:$(h),success:function(e){ae(e,t,i)},fail:function(e){ce(e,i)},debug:n,url:l})},where_now:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.auth_key||x,r=z(),s=e.uuid||G,o={auth:i};return t?I?("0"!=r&&(o.callback=r),J&&(o.instanceid=V),void ue({callback:r,data:$(o),success:function(e){ae(e,t,n)},fail:function(e){ce(e,n)},url:[E,"v2","presence","sub_key",I,"uuid",de.encode(s)]})):H("Missing Subscribe Key"):H("Missing Callback")},state:function(e,t){t=e.callback||t||function(e){};var n,i=e.error||function(){},r=e.auth_key||x,s=z(),o=e.state,a=e.uuid||G,c=e.channel,u=e.channel_group,h=$({auth:r});return I?a?c||u?("0"!=s&&(h.callback=s),void 0!==c&&D[c]&&D[c].subscribed&&o&&(L[c]=o),void 0!==u&&R[u]&&R[u].subscribed&&(o&&(L[u]=o),h["channel-group"]=u,c||(c=",")),h.state=JSON.stringify(o),J&&(h.instanceid=V),n=o?[E,"v2","presence","sub-key",I,"channel",c,"uuid",a,"data"]:[E,"v2","presence","sub-key",I,"channel",c,"uuid",de.encode(a)],void ue({callback:s,data:$(h),success:function(e){ae(e,t,i)},fail:function(e){ce(e,i)},url:n})):H("Missing Channel"):H("Missing UUID"):H("Missing Subscribe Key")},grant:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.channel||e.channels,r=e.channel_group,s=z(),o=e.ttl,a=e.read?"1":"0",c=e.write?"1":"0",u=e.manage?"1":"0",h=e.auth_key||e.auth_keys;if(!t)return H("Missing Callback");if(!I)return H("Missing Subscribe Key");if(!g)return H("Missing Publish Key");if(!p)return H("Missing Secret Key");var l={w:c,r:a};e.manage&&(l.m=u),de.isArray(i)&&(i=i.join(",")),de.isArray(h)&&(h=h.join(",")),void 0!==i&&null!=i&&0<i.length&&(l.channel=i),void 0!==r&&null!=r&&0<r.length&&(l["channel-group"]=r),"0"!=s&&(l.callback=s),(o||0===o)&&(l.ttl=o),h&&(l.auth=h),l=$(l),h||delete l.auth,ue({operation:"PNAccessManagerGrant",callback:s,data:l,success:function(e){ae(e,t,n)},fail:function(e){ce(e,n)},url:[E,"v1","auth","grant","sub-key",I]})},mobile_gw_provision:function(e){var t,n,i=e.callback||function(){},r=e.auth_key||x,s=e.error||function(){},o=z(),a=e.channel,c=e.op,u=e.gw_type,h=e.device_id;return h?u?c?a?I?(n=[E,"v1/push/sub-key",I,"devices",h],t={uuid:G,auth:r,type:u},"add"==c?t.add=a:"remove"==c&&(t.remove=a),J&&(t.instanceid=V),void ue({callback:o,data:t,success:function(e){ae(e,i,s)},fail:function(e){ce(e,s)},url:n})):H("Missing Subscribe Key"):H("Missing gw destination Channel (channel)"):H("Missing GW Operation (op: add or remove)"):H("Missing GW Type (gw_type: gcm or apns)"):H("Missing Device ID (device_id)")},audit:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.channel,r=e.channel_group,s=e.auth_key,o=z();if(!t)return H("Missing Callback");if(!I)return H("Missing Subscribe Key");if(!g)return H("Missing Publish Key");if(!p)return H("Missing Secret Key");var a={};"0"!=o&&(a.callback=o),void 0!==i&&null!=i&&0<i.length&&(a.channel=i),void 0!==r&&null!=r&&0<r.length&&(a["channel-group"]=r),s&&(a.auth=s),a=$(a),s||delete a.auth,ue({operation:"PNAccessManagerAudit",callback:o,data:a,success:function(e){ae(e,t,n)},fail:function(e){ce(e,n)},url:[E,"v1","auth","audit","sub-key",I]})},revoke:function(e,t){e.read=!1,e.write=!1,le.grant(e,t)},set_uuid:function(e){G=e,B()},get_uuid:function(){return G},isArray:function(e){return de.isArray(e)},get_subscribed_channels:function(){return _e(D,!0)},presence_heartbeat:function(e){var t=e.callback||function(){},n=e.error||function(){},i=z(),r={uuid:G,auth:x};2<JSON.stringify(L).length&&(r.state=JSON.stringify(L)),0<U&&U<320&&(r.heartbeat=U),"0"!=i&&(r.callback=i);var s=de.encode(_e(D,!0).join(",")),o=Ie(R,!0).join(",");s||(s=","),o&&(r["channel-group"]=o),J&&(r.instanceid=V),ue({callback:i,data:$(r),url:[E,"v2","presence","sub-key",I,"channel",s,"heartbeat"],success:function(e){ae(e,t,n)},fail:function(e){ce(e,n)}})},stop_timers:function(){clearTimeout(n),clearTimeout(i),clearTimeout(t)},shutdown:function(){le.stop_timers(),X&&X()},xdr:h,ready:xe,db:F,uuid:de.generateUUID,map:de.map,each:de.each,"each-channel":oe,grep:de.grep,offline:function(){fe(1,{message:"Offline. Please check your network settings."})},supplant:de.supplant,now:de.rnow,unique:we,updater:de.updater};function fe(e,t){A&&A(e,t),A=null,clearTimeout(n),clearTimeout(i)}function pe(i,e){var r=de.rnow();function t(e){if(e){var t=e/1e4,n=(de.rnow()-r)/2;M=de.rnow()-(t+n),i&&i(M)}}e&&t(e)||le.time(t)}return G||(G=le.uuid()),V||(V=le.uuid()),F.set(I+"uuid",G),n=de.timeout(function e(){b()||fe(1,{error:"Offline. Please check your network settings."}),n&&clearTimeout(n),n=de.timeout(e,ve)},ve),i=de.timeout(function t(){s&&le.time(function(e){pe(function(){},e),e||fe(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),i&&clearTimeout(i),i=de.timeout(t,r)})},r),t=de.timeout(ie,(o-3)*ve),pe(),le},unique:we,PNmessage:function(e){var r=e||{apns:{}};return r.getPubnubMessage=function(){var e={};if(Object.keys(r.apns).length){for(var t in e.pn_apns={aps:{alert:r.apns.alert,badge:r.apns.badge,sound:r.apns.sound}},r.apns)e.pn_apns[t]=r.apns[t];var n=["badge","alert","sound"];for(var t in n)delete e.pn_apns[n[t]]}for(var t in r.gcm&&(e.pn_gcm={data:r.gcm}),r)e[t]=r[t];var i=["apns","gcm","publish","channel","callback","error"];for(var t in i)delete e[i[t]];return e},r.publish=function(){var e=r.getPubnubMessage();r.pubnub&&r.channel&&r.pubnub.publish({message:e,channel:r.channel,callback:r.callback,error:r.error})},r},DEF_TIMEOUT:15e3,timeout:de.timeout,build_url:de.buildURL,each:de.each,uuid:de.generateUUID,URLBIT:r.URLBIT,grep:de.grep,supplant:de.supplant,now:de.rnow,updater:de.updater,map:de.map}},function(e,t){e.exports={name:"pubnub",preferGlobal:!1,version:"3.16.5",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0"},noAnalyze:!1,devDependencies:{chai:"^3.5.0",eslint:"2.4.0","eslint-config-airbnb":"^6.0.2","eslint-plugin-flowtype":"^2.1.0","eslint-plugin-mocha":"^2.0.0","eslint-plugin-react":"^4.1.0","flow-bin":"^0.22.0",grunt:"^0.4.5","grunt-contrib-clean":"^1.0.0","grunt-contrib-copy":"^0.8.2","grunt-contrib-uglify":"^0.11.1","grunt-env":"^0.4.4","grunt-eslint":"^18.0.0","grunt-flow":"^1.0.3","grunt-karma":"^0.12.1","grunt-mocha-istanbul":"^3.0.1","grunt-text-replace":"^0.4.0","grunt-webpack":"^1.0.11","imports-loader":"^0.6.5",isparta:"^4.0.0","json-loader":"^0.5.4",karma:"^0.13.21","karma-chai":"^0.1.0","karma-mocha":"^0.2.1","karma-phantomjs-launcher":"^1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.0",mocha:"^2.4.5",nock:"^1.1.0","node-uuid":"^1.4.7",nodeunit:"^0.9.0","phantomjs-prebuilt":"^2.1.4",proxyquire:"^1.7.4",sinon:"^1.17.2","uglify-js":"^2.6.1",underscore:"^1.7.0",webpack:"^1.12.13","webpack-dev-server":"^1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(e,t){e.exports={PARAMSBIT:"&",URLBIT:"/"}},function(e,t,n){var r=n(6),i=/{([\w\-]+)}/g;function s(){return+new Date}function o(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function a(e,t){if(e&&t)if(o(e))for(var n=0,i=e.length;n<i;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function c(e){return encodeURIComponent(e)}e.exports={buildURL:function(e,t){var n=e.join(r.URLBIT),i=[];return t?(a(t,function(e,t){var n="object"==typeof t?JSON.stringify(t):t;null!=t&&0<c(n).length&&i.push(e+"="+c(n))}),n+="?"+i.join(r.PARAMSBIT)):n},encode:c,each:a,updater:function(e,t){var n,i=0,r=function(){i+t>s()?(clearTimeout(n),n=setTimeout(r,t)):(i=s(),e())};return r},rnow:s,isArray:o,map:function(e,n){var i=[];return a(e||[],function(e,t){i.push(n(e,t))}),i},pamEncode:function(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})},generateUUID:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return e&&e(t),t},timeout:function(e,t){if("undefined"!=typeof setTimeout)return setTimeout(e,t)},supplant:function(e,n){return e.replace(i,function(e,t){return n[t]||e})},grep:function(e,t){var n=[];return a(e||[],function(e){t(e)&&n.push(e)}),n}}},function(e,t){var s=function(e,t){if(!(this instanceof s))return new s(e,t);var n=this,i=(e=n.url=e||"",n.protocol=t||"Sec-WebSocket-Protocol",e.split("/")),r={ssl:"wss:"===i[0],origin:i[2],publish_key:i[3],subscribe_key:i[4],channel:i[5]};if(n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,n.CLOSE_NORMAL=1e3,n.CLOSE_GOING_AWAY=1001,n.CLOSE_PROTOCOL_ERROR=1002,n.CLOSE_UNSUPPORTED=1003,n.CLOSE_TOO_LARGE=1004,n.CLOSE_NO_STATUS=1005,n.CLOSE_ABNORMAL=1006,n.onclose=n.onerror=n.onmessage=n.onopen=n.onsend=function(){},n.binaryType="",n.extensions="",n.bufferedAmount=0,n.trasnmitting=!1,n.buffer=[],n.readyState=n.CONNECTING,!e)return n.readyState=n.CLOSED,n.onclose({code:n.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),n;n.pubnub=PUBNUB.init(r),n.pubnub.setup=r,n.setup=r,n.pubnub.subscribe({restore:!1,channel:r.channel,disconnect:n.onerror,reconnect:n.onopen,error:function(){n.onclose({code:n.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){n.onmessage({data:e})},connect:function(){n.readyState=n.OPEN,n.onopen()}})};s.prototype.send=function(e){var t=this;t.pubnub.publish({channel:t.pubnub.setup.channel,message:e,callback:function(e){t.onsend({data:e})}})},s.prototype.close=function(){var e=this;e.pubnub.unsubscribe({channel:e.pubnub.setup.channel}),e.readyState=e.CLOSED,e.onclose({})},e.exports=s}])}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SinchClient=e()}}(function(){return function s(o,a,c){function u(t,e){if(!a[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(h)return h(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[t]={exports:{}};o[t][0].call(r.exports,function(e){return u(o[t][1][e]||e)},r,r.exports,s,o,a,c)}return a[t].exports}for(var h="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,n){VERSION=["1.4.8-0-g777b7c1","1.4.8","0","777b7c1",null],n.version=VERSION},{}],2:[function(e,t,n){"use strict";n.byteLength=function(e){var t=p(e),n=t[0],i=t[1];return 3*(n+i)/4-i},n.toByteArray=function(e){for(var t,n=p(e),i=n[0],r=n[1],s=new f((u=i,h=r,3*(u+h)/4-h)),o=0,a=0<r?i-4:i,c=0;c<a;c+=4)t=l[e.charCodeAt(c)]<<18|l[e.charCodeAt(c+1)]<<12|l[e.charCodeAt(c+2)]<<6|l[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=255&t;var u,h;2===r&&(t=l[e.charCodeAt(c)]<<2|l[e.charCodeAt(c+1)]>>4,s[o++]=255&t);1===r&&(t=l[e.charCodeAt(c)]<<10|l[e.charCodeAt(c+1)]<<4|l[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=255&t);return s},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,r=[],s=0,o=n-i;s<o;s+=16383)r.push(c(e,s,o<s+16383?o:s+16383));1===i?(t=e[n-1],r.push(a[t>>2]+a[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],r.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return r.join("")};for(var a=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,s=i.length;r<s;++r)a[r]=i[r],l[i.charCodeAt(r)]=r;function p(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var i,r,s=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(a[(r=i)>>18&63]+a[r>>12&63]+a[r>>6&63]+a[63&r]);return s.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],3:[function(e,n,t){(function(t){!function(){"use strict";n.exports=function(e){return(e instanceof t?e:t.from(e.toString(),"binary")).toString("base64")}}()}).call(this,e("buffer").Buffer)},{buffer:4}],4:[function(e,t,n){"use strict";var i=e("base64-js"),s=e("ieee754");n.Buffer=l,n.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},n.INSPECT_MAX_BYTES=50;var r=2147483647;function o(e){if(r<e)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=l.prototype,t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(e)}return a(e,t,n)}function a(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return D(e)||e&&D(e.buffer)?function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return i.__proto__=l.prototype,i}(e,t,n):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|p(e,t),i=o(n),r=i.write(e,t);r!==n&&(i=i.slice(0,r));return i}(e,t):function(e){if(l.isBuffer(e)){var t=0|f(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||R(e.length)?o(0):h(e);if("Buffer"===e.type&&Array.isArray(e.data))return h(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e){return c(e),o(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),n=o(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function f(e){if(r<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return N(e).length;default:if(i)return P(e).length;t=(""+t).toLowerCase(),i=!0}}function d(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function g(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),R(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a/=o=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var h=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(a<n+c&&(n=a-c),s=n;0<=s;s--){for(var l=!0,f=0;f<c;f++)if(u(e,s+f)!==u(t,f)){l=!1;break}if(l)return s}return-1}function m(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?r<(i=Number(i))&&(i=r):i=r;var s=t.length;s/2<i&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(t.substr(2*o,2),16);if(R(a))return o;e[n+o]=a}return o}function v(e,t,n,i){return j(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function b(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,o,a,c,u=e[r],h=null,l=239<u?4:223<u?3:191<u?2:1;if(r+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[r+1]))&&127<(c=(31&u)<<6|63&s)&&(h=c);break;case 3:s=e[r+1],o=e[r+2],128==(192&s)&&128==(192&o)&&2047<(c=(15&u)<<12|(63&s)<<6|63&o)&&(c<55296||57343<c)&&(h=c);break;case 4:s=e[r+1],o=e[r+2],a=e[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&65535<(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)&&c<1114112&&(h=c)}null===h?(h=65533,l=1):65535<h&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),r+=l}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=S));return n}(i)}n.kMaxLength=r,(l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{get:function(){if(this instanceof l)return this.buffer}}),Object.defineProperty(l.prototype,"offset",{get:function(){if(this instanceof l)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=function(e,t,n){return a(e,t,n)},l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(e,t,n){return r=t,s=n,c(i=e),i<=0?o(i):void 0!==r?"string"==typeof s?o(i).fill(r,s):o(i).fill(r):o(i);var i,r,s},l.allocUnsafe=function(e){return u(e)},l.allocUnsafeSlow=function(e){return u(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(ArrayBuffer.isView(s)&&(s=l.from(s)),!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return _(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,i,r){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(r<=i&&n<=t)return 0;if(r<=i)return-1;if(n<=t)return 1;if(this===e)return 0;for(var s=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(t>>>=0),a=Math.min(s,o),c=this.slice(i,r),u=e.slice(t,n),h=0;h<a;++h)if(c[h]!==u[h]){s=c[h],o=u[h];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||r<n)&&(n=r),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s,o,a,c,u,h,l,f,p,d=!1;;)switch(i){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return f=t,p=n,j(P(e,(l=this).length-f),l,f,p);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return c=this,u=t,h=n,j(N(e),c,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=t,a=n,j(function(e,t){for(var n,i,r,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,s.push(r),s.push(i);return s}(e,(s=this).length-o),s,o,a);default:if(d)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),d=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function _(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function I(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function x(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||i<n)&&(n=i);for(var r="",s=t;s<n;++s)r+=A(e[s]);return r}function C(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,i,r,s){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r<t||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,i,r){return t=+t,n>>>=0,r||B(e,0,n,4),s.write(e,t,n,i,23,4),n+4}function T(e,t,n,i,r){return t=+t,n>>>=0,r||B(e,0,n,8),s.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return i.__proto__=l.prototype,i},l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e+--t],r=1;0<t&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return(r*=128)<=i&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=t,r=1,s=this[e+--i];0<i&&(r*=256);)s+=this[e+--i]*r;return(r*=128)<=s&&(s-=Math.pow(2,8*t)),s},l.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),s.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),s.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),s.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),s.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t>>>=0,n>>>=0,i)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t>>>=0,n>>>=0,i)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,s=1;for(this[t+r]=255&e;0<=--r&&(s*=256);)this[t+r]=e/s&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;0<=--s&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),0<i&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,i);else if(this===e&&n<t&&t<i)for(var s=r-1;0<=s;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),t);return r},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var r=e.charCodeAt(0);("utf8"===i&&r<128||"latin1"===i)&&(e=r)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=l.isBuffer(e)?e:new l(e,i),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var O=/[^+/0-9A-Za-z-_]/g;function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function P(e,t){var n;t=t||1/0;for(var i=e.length,r=null,s=[],o=0;o<i;++o){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!r){if(56319<n){-1<(t-=3)&&s.push(239,191,189);continue}if(o+1===i){-1<(t-=3)&&s.push(239,191,189);continue}r=n;continue}if(n<56320){-1<(t-=3)&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&-1<(t-=3)&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function N(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function D(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function R(e){return e!=e}},{"base64-js":2,ieee754:11}],5:[function(e,t,n){var i,r;i=this,r=function(){var h,n,e,t,i,l,r,s,o,a,c,u,f=f||(h=Math,n=Object.create||function(){function n(){}return function(e){var t;return n.prototype=e,t=new n,n.prototype=null,t}}(),t=(e={}).lib={},i=t.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=t.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<r;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(s=0;s<r;s+=4)t[i+s>>>2]=n[s>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=h.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],i=function(t){t=t;var n=987654321,i=4294967295;return function(){var e=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return e/=4294967296,(e+=.5)*(.5<h.random()?1:-1)}},r=0;r<e;r+=4){var s=i(4294967296*(t||h.random()));t=987654071*s(),n.push(4294967296*s()|0)}return new l.init(n,e)}}),r=e.enc={},s=r.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new l.init(n,t/2)}},o=r.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new l.init(n,t)}},a=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(o.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return o.parse(unescape(encodeURIComponent(e)))}},c=t.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=a.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,r=this.blockSize,s=i/(4*r),o=(s=e?h.ceil(s):h.max((0|s)-this._minBufferSize,0))*r,a=h.min(4*o,i);if(o){for(var c=0;c<o;c+=r)this._doProcessBlock(n,c);var u=n.splice(0,o);t.sigBytes-=a}return new l.init(u,a)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),t.Hasher=c.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new u.HMAC.init(n,t).finalize(e)}}}),u=e.algo={},e);return f},"object"==typeof n?t.exports=n=r():i.CryptoJS=r()},{}],6:[function(e,t,n){var i,r;i=this,r=function(e){var t,c;return c=(t=e).lib.WordArray,t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],s=0;s<n;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)r.push(i.charAt(o>>>6*(3-a)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var r=0;r<n.length;r++)i[n.charCodeAt(r)]=r}var s=n.charAt(64);if(s){var o=e.indexOf(s);-1!==o&&(t=o)}return function(e,t,n){for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n[e.charCodeAt(s-1)]<<s%4*2,a=n[e.charCodeAt(s)]>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return c.create(i,r)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},e.enc.Base64},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],7:[function(e,t,n){var i,r;i=this,r=function(e){return e.enc.Utf8},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],8:[function(e,t,n){var i,r;i=this,r=function(e){return e.HmacSHA256},"object"==typeof n?t.exports=n=r(e("./core"),e("./sha256"),e("./hmac")):r(i.CryptoJS)},{"./core":5,"./hmac":9,"./sha256":10}],9:[function(e,t,n){var i,r;i=this,r=function(e){var t,n,u;n=(t=e).lib.Base,u=t.enc.Utf8,t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),s=this._iKey=t.clone(),o=r.words,a=s.words,c=0;c<n;c++)o[c]^=1549556828,a[c]^=909522486;r.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],10:[function(e,t,n){var i,r;i=this,r=function(c){return function(r){var e=c,t=e.lib,n=t.WordArray,i=t.Hasher,s=e.algo,o=[],b=[];!function(){function e(e){for(var t=r.sqrt(e),n=2;n<=t;n++)if(!(e%n))return!1;return!0}function t(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(o[i]=t(r.pow(n,.5))),b[i]=t(r.pow(n,1/3)),i++),n++}();var w=[],a=s.SHA256=i.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],u=n[6],h=n[7],l=0;l<64;l++){if(l<16)w[l]=0|e[t+l];else{var f=w[l-15],p=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,d=w[l-2],g=(d<<15|d>>>17)^(d<<13|d>>>19)^d>>>10;w[l]=p+w[l-7]+g+w[l-16]}var y=i&r^i&s^r&s,m=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),v=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+b[l]+w[l];h=u,u=c,c=a,a=o+v|0,o=s,s=r,r=i,i=v+(m+y)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=r.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=i._createHelper(a),e.HmacSHA256=i._createHmacHelper(a)}(Math),c.SHA256},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],11:[function(e,t,n){n.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?r-1:0,f=n?-1:1,p=e[t+l];for(l+=f,s=p&(1<<-h)-1,p>>=-h,h+=a;0<h;s=256*s+e[t+l],l+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;0<h;o=256*o+e[t+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=u}return(p?-1:1)*o*Math.pow(2,s-i)},n.write=function(e,t,n,i,r,s){var o,a,c,u=8*s-r-1,h=(1<<u)-1,l=h>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,d=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),2<=(t+=1<=o+l?f/c:f*Math.pow(2,1-l))*c&&(o++,c/=2),h<=o+l?(a=0,o=h):1<=o+l?(a=(t*c-1)*Math.pow(2,r),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,r),o=0));8<=r;e[n+p]=255&a,p+=d,a/=256,r-=8);for(o=o<<r|a,u+=r;0<u;e[n+p]=255&o,p+=d,o/=256,u-=8);e[n+p-d]|=128*g}},{}],12:[function(e,t,n){var i,r,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,h=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?h=u.concat(h):f=-1,h.length&&d())}function d(){if(!l){var e=c(p);l=!0;for(var t=h.length;t;){for(u=h,h=[];++f<t;)u&&u[f].run();f=-1,t=h.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function y(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new g(e,t)),1!==h.length||l||c(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=y,s.addListener=y,s.once=y,s.off=y,s.removeListener=y,s.removeAllListeners=y,s.emit=y,s.prependListener=y,s.prependOnceListener=y,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],13:[function(e,i,r){(function(X,q){!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof r&&"object"==typeof i)i.exports=e();else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var t="undefined"!=typeof window?window:self,n=t.Q;t.Q=e(),t.Q.noConflict=function(){return t.Q=n,this}}}(function(){"use strict";var a=!1;try{throw new Error}catch(e){a=!!e.stack}var r,s=S(),t=function(){},h=function(){var n={task:void 0,next:null},t=n,i=!1,r=void 0,s=!1,o=[];function a(){for(var e,t;n.next;)e=(n=n.next).task,n.task=void 0,(t=n.domain)&&(n.domain=void 0,t.enter()),c(e,t);for(;o.length;)c(e=o.pop());i=!1}function c(e,t){try{e()}catch(e){if(s)throw t&&t.exit(),setTimeout(a,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(h=function(e){t=t.next={task:e,domain:s&&X.domain,next:null},i||(i=!0,r())},"object"==typeof X&&"[object process]"===X.toString()&&X.nextTick)s=!0,r=function(){X.nextTick(a)};else if("function"==typeof q)r="undefined"!=typeof window?q.bind(window,a):function(){q(a)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){r=u,(e.port1.onmessage=a)()};var u=function(){e.port2.postMessage(0)};r=function(){setTimeout(a,0),u()}}else r=function(){setTimeout(a,0)};return h.runAfter=function(e){o.push(e),i||(i=!0,r())},h}(),n=Function.call;function e(e){return function(){return n.apply(e,arguments)}}var c,u=e(Array.prototype.slice),l=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(t=e(t,this[n],n));return t}),o=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),i=e(Array.prototype.map||function(i,r){var s=this,o=[];return l(s,function(e,t,n){o.push(i.call(r,t,n,s))},void 0),o}),f=Object.create||function(e){function t(){}return t.prototype=e,new t},p=Object.defineProperty||function(e,t,n){return e[t]=n.value,e},d=e(Object.prototype.hasOwnProperty),g=Object.keys||function(e){var t=[];for(var n in e)d(e,n)&&t.push(n);return t},y=e(Object.prototype.toString);c="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var m="From previous event:";function v(e,t){if(a&&t.stack&&"object"==typeof e&&null!==e&&e.stack){for(var n=[],i=t;i;i=i.source)i.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>i.stackCounter)&&(p(e,"__minimumStackCounter__",{value:i.stackCounter,configurable:!0}),n.unshift(i.stack));n.unshift(e.stack);var r=function(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var r=t[i];!w(r)&&(-1===(s=r).indexOf("(module.js:")&&-1===s.indexOf("(node.js:"))&&r&&n.push(r)}var s;return n.join("\n")}(n.join("\n"+m+"\n"));p(e,"stack",{value:r,configurable:!0})}}function b(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function w(e){var t=b(e);if(!t)return!1;var n=t[0],i=t[1];return n===r&&s<=i&&i<=V}function S(){if(a)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=b(0<t[0].indexOf("@")?t[1]:t[2]);if(!n)return;return r=n[0],n[1]}}function _(e){return e instanceof k?e:O(e)?(t=e,n=x(),_.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise):z(e);var t,n}(_.resolve=_).nextTick=h,_.longStackSupport=!1;var I=1;function x(){var r,s=[],o=[],e=f(x.prototype),t=f(k.prototype);if(t.promiseDispatch=function(e,t,n){var i=u(arguments);s?(s.push(i),"when"===t&&n[1]&&o.push(n[1])):_.nextTick(function(){r.promiseDispatch.apply(r,i)})},t.valueOf=function(){if(s)return t;var e=M(r);return T(e)&&(r=e),e},t.inspect=function(){return r?r.inspect():{state:"pending"}},_.longStackSupport&&a)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1),t.stackCounter=I++}function n(n){r=n,_.longStackSupport&&a&&(t.source=n),l(s,function(e,t){_.nextTick(function(){n.promiseDispatch.apply(n,t)})},void 0),o=s=void 0}return e.promise=t,e.resolve=function(e){r||n(_(e))},e.fulfill=function(e){r||n(z(e))},e.reject=function(e){r||n(H(e))},e.notify=function(n){r||l(o,function(e,t){_.nextTick(function(){t(n)})},void 0)},e}function C(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=x();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function E(r){return C(function(e,t){for(var n=0,i=r.length;n<i;n++)_(r[n]).then(e,t)})}function k(r,s,t){void 0===s&&(s=function(e){return H(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var o=f(k.prototype);if(o.promiseDispatch=function(e,t,n){var i;try{i=r[t]?r[t].apply(o,n):s.call(o,t,n)}catch(e){i=H(e)}e&&e(i)},o.inspect=t){var e=t();"rejected"===e.state&&(o.exception=e.reason),o.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?o:e.value}}return o}function B(e,t,n,i){return _(e).then(t,n,i)}function M(e){if(T(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function T(e){return e instanceof k}function O(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}"object"==typeof X&&X&&X.env&&X.env.Q_DEBUG&&(_.longStackSupport=!0),(_.defer=x).prototype.makeNodeResolver=function(){var n=this;return function(e,t){e?n.reject(e):2<arguments.length?n.resolve(u(arguments,1)):n.resolve(t)}},_.Promise=C,(_.promise=C).race=E,C.all=J,C.reject=H,(C.resolve=_).passByCopy=function(e){return e},k.prototype.passByCopy=function(){return this},_.join=function(e,t){return _(e).join(t)},k.prototype.join=function(e){return _([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Q can't join: not the same: "+e+" "+t)})},_.race=E,k.prototype.race=function(){return this.then(_.race)},(_.makePromise=k).prototype.toString=function(){return"[object Promise]"},k.prototype.then=function(t,n,r){var i=this,s=x(),o=!1;return _.nextTick(function(){i.promiseDispatch(function(e){o||(o=!0,s.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return H(e)}}(e)))},"when",[function(e){o||(o=!0,s.resolve(function(e){if("function"==typeof n){v(e,i);try{return n(e)}catch(e){return H(e)}}return H(e)}(e)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(e){var t,n,i=!1;try{n=e,t="function"==typeof r?r(n):n}catch(e){if(i=!0,!_.onerror)throw e;_.onerror(e)}i||s.notify(t)}]),s.promise},_.tap=function(e,t){return _(e).tap(t)},k.prototype.tap=function(t){return t=_(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},_.when=B,k.prototype.thenResolve=function(e){return this.then(function(){return e})},_.thenResolve=function(e,t){return _(e).thenResolve(t)},k.prototype.thenReject=function(e){return this.then(function(){throw e})},_.thenReject=function(e,t){return _(e).thenReject(t)},_.nearer=M,_.isPromise=T,_.isPromiseAlike=O,_.isPending=function(e){return T(e)&&"pending"===e.inspect().state},k.prototype.isPending=function(){return"pending"===this.inspect().state},_.isFulfilled=function(e){return!T(e)||"fulfilled"===e.inspect().state},k.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},_.isRejected=function(e){return T(e)&&"rejected"===e.inspect().state},k.prototype.isRejected=function(){return"rejected"===this.inspect().state};var A,P,N,j=[],D=[],R=[],L=!0;function U(){j.length=0,D.length=0,L||(L=!0)}function H(t){var e,n,i=k({when:function(e){return e&&function(t){if(L){var n=o(D,t);-1!==n&&("object"==typeof X&&"function"==typeof X.emit&&_.nextTick.runAfter(function(){var e=o(R,t);-1!==e&&(X.emit("rejectionHandled",j[n],t),R.splice(e,1))}),D.splice(n,1),j.splice(n,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return e=i,n=t,L&&("object"==typeof X&&"function"==typeof X.emit&&_.nextTick.runAfter(function(){-1!==o(D,e)&&(X.emit("unhandledRejection",n,e),R.push(e))}),D.push(e),n&&void 0!==n.stack?j.push(n.stack):j.push("(no stack) "+n)),i}function z(n){return k({when:function(){return n},get:function(e){return n[e]},set:function(e,t){n[e]=t},delete:function(e){delete n[e]},post:function(e,t){return null==e?n.apply(void 0,t):n[e].apply(n,t)},apply:function(e,t){return n.apply(e,t)},keys:function(){return g(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function F(e,t,n){return _(e).spread(t,n)}function G(e,t,n){return _(e).dispatch(t,n)}function J(e){return B(e,function(r){var s=0,o=x();return l(r,function(e,t,n){var i;T(t)&&"fulfilled"===(i=t.inspect()).state?r[n]=i.value:(++s,B(t,function(e){r[n]=e,0==--s&&o.resolve(r)},o.reject,function(e){o.notify({index:n,value:e})}))},void 0),0===s&&o.resolve(r),o.promise})}function K(r){if(0===r.length)return _.resolve();var s=_.defer(),o=0;return l(r,function(e,t,n){var i=r[n];o++,B(i,function(e){s.resolve(e)},function(e){if(0==--o){var t=e||new Error(""+e);t.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+t.message,s.reject(t)}},function(e){s.notify({index:n,value:e})})},void 0),s.promise}function W(e){return B(e,function(e){return e=i(e,_),B(J(i(e,function(e){return B(e,t,t)})),function(){return e})})}_.resetUnhandledRejections=U,_.getUnhandledReasons=function(){return j.slice()},_.stopUnhandledRejectionTracking=function(){U(),L=!1},U(),_.reject=H,_.fulfill=z,_.master=function(n){return k({isDef:function(){}},function(e,t){return G(n,e,t)},function(){return _(n).inspect()})},_.spread=F,k.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},_.async=function(t){return function(){function e(e,t){var n,i;if("undefined"==typeof StopIteration){try{n=r[e](t)}catch(e){return H(e)}return n.done?_(n.value):B(n.value,s,o)}try{n=r[e](t)}catch(e){return"[object StopIteration]"===y(i=e)||i instanceof c?_(e.value):H(e)}return B(n,s,o)}var r=t.apply(this,arguments),s=e.bind(e,"next"),o=e.bind(e,"throw");return s()}},_.spawn=function(e){_.done(_.async(e)())},_.return=function(e){throw new c(e)},_.promised=function(n){return function(){return F([this,J(arguments)],function(e,t){return n.apply(e,t)})}},_.dispatch=G,k.prototype.dispatch=function(e,t){var n=this,i=x();return _.nextTick(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},_.get=function(e,t){return _(e).dispatch("get",[t])},k.prototype.get=function(e){return this.dispatch("get",[e])},_.set=function(e,t,n){return _(e).dispatch("set",[t,n])},k.prototype.set=function(e,t){return this.dispatch("set",[e,t])},_.del=_.delete=function(e,t){return _(e).dispatch("delete",[t])},k.prototype.del=k.prototype.delete=function(e){return this.dispatch("delete",[e])},_.mapply=_.post=function(e,t,n){return _(e).dispatch("post",[t,n])},k.prototype.mapply=k.prototype.post=function(e,t){return this.dispatch("post",[e,t])},_.send=_.mcall=_.invoke=function(e,t){return _(e).dispatch("post",[t,u(arguments,2)])},k.prototype.send=k.prototype.mcall=k.prototype.invoke=function(e){return this.dispatch("post",[e,u(arguments,1)])},_.fapply=function(e,t){return _(e).dispatch("apply",[void 0,t])},k.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},_.try=_.fcall=function(e){return _(e).dispatch("apply",[void 0,u(arguments,1)])},k.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},_.fbind=function(e){var t=_(e),n=u(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(u(arguments))])}},k.prototype.fbind=function(){var e=this,t=u(arguments);return function(){return e.dispatch("apply",[this,t.concat(u(arguments))])}},_.keys=function(e){return _(e).dispatch("keys",[])},k.prototype.keys=function(){return this.dispatch("keys",[])},_.all=J,k.prototype.all=function(){return J(this)},_.any=K,k.prototype.any=function(){return K(this)},_.allResolved=(A=W,P="allResolved",N="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(P+" is deprecated, use "+N+" instead.",new Error("").stack),A.apply(A,arguments)}),k.prototype.allResolved=function(){return W(this)},_.allSettled=function(e){return _(e).allSettled()},k.prototype.allSettled=function(){return this.then(function(e){return J(i(e,function(e){function t(){return e.inspect()}return(e=_(e)).then(t,t)}))})},_.fail=_.catch=function(e,t){return _(e).then(void 0,t)},k.prototype.fail=k.prototype.catch=function(e){return this.then(void 0,e)},_.progress=function(e,t){return _(e).then(void 0,void 0,t)},k.prototype.progress=function(e){return this.then(void 0,void 0,e)},_.fin=_.finally=function(e,t){return _(e).finally(t)},k.prototype.fin=k.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=_(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},_.done=function(e,t,n,i){return _(e).done(t,n,i)},k.prototype.done=function(e,t,n){var i=function(e){_.nextTick(function(){if(v(e,r),!_.onerror)throw e;_.onerror(e)})},r=e||t||n?this.then(e,t,n):this;"object"==typeof X&&X&&X.domain&&(i=X.domain.bind(i)),r.then(void 0,i)},_.timeout=function(e,t,n){return _(e).timeout(t,n)},k.prototype.timeout=function(e,t){var n=x(),i=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},_.delay=function(e,t){return void 0===t&&(t=e,e=void 0),_(e).delay(t)},k.prototype.delay=function(n){return this.then(function(e){var t=x();return setTimeout(function(){t.resolve(e)},n),t.promise})},_.nfapply=function(e,t){return _(e).nfapply(t)},k.prototype.nfapply=function(e){var t=x(),n=u(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},_.nfcall=function(e){var t=u(arguments,1);return _(e).nfapply(t)},k.prototype.nfcall=function(){var e=u(arguments),t=x();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfbind=_.denodeify=function(n){if(void 0===n)throw new Error("Q can't wrap an undefined function");var i=u(arguments,1);return function(){var e=i.concat(u(arguments)),t=x();return e.push(t.makeNodeResolver()),_(n).fapply(e).fail(t.reject),t.promise}},k.prototype.nfbind=k.prototype.denodeify=function(){var e=u(arguments);return e.unshift(this),_.denodeify.apply(void 0,e)},_.nbind=function(n,i){var r=u(arguments,2);return function(){var e=r.concat(u(arguments)),t=x();return e.push(t.makeNodeResolver()),_(function(){return n.apply(i,arguments)}).fapply(e).fail(t.reject),t.promise}},k.prototype.nbind=function(){var e=u(arguments,0);return e.unshift(this),_.nbind.apply(void 0,e)},_.nmapply=_.npost=function(e,t,n){return _(e).npost(t,n)},k.prototype.nmapply=k.prototype.npost=function(e,t){var n=u(t||[]),i=x();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},_.nsend=_.nmcall=_.ninvoke=function(e,t){var n=u(arguments,2),i=x();return n.push(i.makeNodeResolver()),_(e).dispatch("post",[t,n]).fail(i.reject),i.promise},k.prototype.nsend=k.prototype.nmcall=k.prototype.ninvoke=function(e){var t=u(arguments,1),n=x();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},_.nodeify=function(e,t){return _(e).nodeify(t)},k.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){_.nextTick(function(){t(null,e)})},function(e){_.nextTick(function(){t(e)})})},_.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var V=S();return _})}).call(this,e("_process"),e("timers").setImmediate)},{_process:12,timers:16}],14:[function(e,t,n){var o=e("btoa"),a=(e("atob"),e("crypto-js/hmac-sha256")),c=e("crypto-js/enc-base64");e("crypto-js/enc-utf8");t.exports=function(e,t,n,i){var r={applicationKey:e,identity:{type:"username",endpoint:n.username},created:i||(new Date).toISOString(),expiresIn:86400},s=JSON.stringify(r).replace(" ","");return{userTicket:o(s)+":"+a(s,c.parse(t)).toString(c)}}},{atob:15,btoa:3,"crypto-js/enc-base64":6,"crypto-js/enc-utf8":7,"crypto-js/hmac-sha256":8}],15:[function(e,n,t){(function(t){!function(){"use strict";n.exports=function(e){return new t(e,"base64").toString("binary")}}()}).call(this,e("buffer").Buffer)},{buffer:4}],16:[function(c,e,u){(function(e,t){var i=c("process/browser.js").nextTick,n=Function.prototype.apply,r=Array.prototype.slice,s={},o=0;function a(e,t){this._id=e,this._clearFn=t}u.setTimeout=function(){return new a(n.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new a(n.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},u.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},u._unrefActive=u.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},u.setImmediate="function"==typeof e?e:function(e){var t=o++,n=!(arguments.length<2)&&r.call(arguments,1);return s[t]=!0,i(function(){s[t]&&(n?e.apply(null,n):e.call(null),u.clearImmediate(t))}),t},u.clearImmediate="function"==typeof t?t:function(e){delete s[e]}}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":12,timers:16}],17:[function(e,t,n){var i,u=e("q"),r=e("../VERSION"),s=e("sinch-ticketgen"),o=0,c=1,a=2,h=3,l=4,f=5,p=7,d=1e3,g=1001,y=2e3,m=2001,v=3003,b=4e3,w=5003,S=6e3,_=6001,I=6002,x=6003,C=6004,E=7001,k=7002,B=7003,M=7005,T=function(e,t){var n={method:e.method,headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json, text/plain, */*"}};for(var i in"GET"!=e.method&&(n.data=t),n.url="",e.urlParts){if(":"===e.urlParts[i][0]){var r=e.urlParts[i].slice(1);n.url+=encodeURIComponent((t||{})[r]).replace(/%2B/g,"+").replace(/%40/g,"@")}else n.url+=e.urlParts[i];i<e.urlParts.length-1&&(n.url+="/")}switch(e.auth){case"sign":n.headers=this.signSession(n);break;case"nosign":n.headers=this.signApp(n);break;case"ticket":n.headers=this.signTicket(n),delete n.data.authorization;break;case"signorticket":this._sessionId?n.headers=this.signSession(n):(n.headers=this.signTicket(n),delete n.data.authorization);break;default:throw new Error("Unsupported authentication type: "+e.auth)}if("GET"===e.method&&t&&0<Object.keys(t).length&&!e.hideQueryParams)for(var s in n.url+="?",t)n.url+=encodeURIComponent(s)+"="+encodeURIComponent(t[s])+"&";return function(e){var t=u.defer(),n=new XMLHttpRequest;for(var i in n.onload=function(){if(200<=n.status&&n.status<300){try{n.response=n.response||n.responseText,n.data=JSON.parse(n.response||"{}")}catch(e){console.log("Cant parse JSON"+n.response)}t.resolve(n.data)}else{try{n.response=n.response||n.responseText,n.data=JSON.parse(n.response||"{}")}catch(e){console.log("Cant parse JSON"+n.response)}t.reject(n)}},n.onerror=function(){t.reject(new Error("Unsupported operation "+n.status,n))},n.open(e.method,e.url,!0),e.headers)n.setRequestHeader(i,e.headers[i]);return n.send(JSON.stringify(e.data)),t.promise}(n)},O=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};function Notification(e,t,n,i){this.progress=e/t,this.message=n,this.object=i}function A(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||t.match(/(applewebkit(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join("/").substring(0,50))}function P(){return navigator.platform}function N(e){if(!e)throw new TypeError("Could not create SinchClient, configuration not provided.");if(e.capabilities=e.capabilities||{},"string"!=typeof e.applicationKey)throw new TypeError("Could not create SinchClient, applicationKey is not a string");this.capabilities=e.capabilities,this._appKey=e.applicationKey||"",this._appSecret=e.applicationSecret||void 0,this._sessionId="",this._sessionSecret="",this._logHandler=e.onLogMessage||function(){},this._logMxpHandler=e.onLogMxpMessage||function(){},this._onlineCapability=e.startActiveConnection||e.supportActiveConnection||!1,this._autoStartMxp=e.startActiveConnection||!1,this._expiresIn=e.expiresIn||86400,this._subInstanceId=Math.round(Math.random()*Math.pow(2,32)),this._customStream=e.customStream||void 0,this._supportVideo=e.capabilities.video||!1,this._multiCall=e.capabilities.multiCall||!1,this.applicationKey=this._appKey,this._supportManagedPush=e.supportManagedPush,this._progressTimeout=e.progressTimeout||10500,this.firefox=!1,"undefined"!=typeof navigator&&(this.firefox=0<(navigator||{userAgent:""}).userAgent.indexOf("Firefox")),this._url={base:"https://api.sinch.com/v1/",user:"https://userapi.sinch.com/v1/",portal:"https://portalapi.sinch.com/v1/",reporting:"https://reportingapi.sinch.com/v1/",reporting_v2:"https://reportingapi.sinch.com/v2/",calling:"https://callingapi.sinch.com/v1/",messaging:"https://messagingapi.sinch.com/v1/",verification:"https://verificationapi-v1.sinch.com/verification/v1/"},this.setUrl(e.urlObj||{}),this.loadPAPIUrl(),this.loadTimeDelta(),this.user=new Z(this),"messaging"in this.capabilities&&this.capabilities.messaging&&(this.messageClient=new Y(this)),"calling"in this.capabilities&&this.capabilities.calling&&(this.callClient=new F(this,e.customStream)),"stealth"in this.capabilities&&this.capabilities.stealth&&(this.callClient=new F(this,e.customStream))}(i=i||{}).base={getServerTime:{url:"timestamp/",method:"GET",auth:"nosign"},getInstance:{url:"instance",method:"POST",auth:"ticket"},renewInstance:{url:"instance",method:"POST",auth:"sign"},renewSecret:{url:"instances/id/:instanceId/authorization",method:"PUT",auth:"ticket"},getInstances:{url:"instances/id/",method:"GET",auth:"sign"}},(i=i||{}).calling={getConfiguration:{url:"configuration/user",method:"GET",auth:"sign"},placeCall:{url:"calls/:domain",method:"POST",auth:"sign"},callReporting:{url:"calls/:domain/id/:callId",method:"PUT",auth:"sign"},postMedia:{url:"media",method:"POST",auth:"sign"},pushCall:{url:"push",method:"POST",auth:"sign"}},(i=i||{}).messaging={getTransportById:{url:"transport",method:"GET",auth:"sign"},getTransportByParticipants:{url:"transport",method:"POST",auth:"sign"},messageReporting:{url:"report/im",method:"POST",auth:"sign"},pushMessage:{url:"push/messages",method:"POST",auth:"sign"}},(i=i||{}).user={authenticate:{url:"users/email/:email/authentication",method:"POST",auth:"nosign"},authenticateUsername:{url:"users/username/:username/authentication",method:"POST",auth:"nosign"},authenticateNumber:{url:"users/number/:number/authentication",method:"POST",auth:"nosign"},createUser:{url:"users",method:"POST",auth:"nosign"},changePassword:{url:"user/password",method:"PUT",auth:"sign"},updateUser:{url:"user/profile",method:"PATCH",auth:"sign"},getUserProfile:{url:"user/profile",method:"GET",auth:"sign"}},(i=i||{}).verification={verify:{url:"verifications",method:"POST",auth:"nosign"},confirmVerification:{url:"verifications/number/:number",method:"PUT",auth:"nosign"},confirmUserCallout:{url:"verifications",method:"POST",auth:"nosign"},confirmFlashCall:{url:"verifications/number/:number",method:"PUT",auth:"nosign"},queryVerificationById:{url:"verifications/callout/number/:number",method:"GET",hideQueryParams:!0,auth:"nosign"}},N.prototype.loadPAPIUrl=function(){for(var e in this.PAPI=JSON.parse(JSON.stringify(i)),i)for(var t in i[e])this.PAPI[e][t].urlParts=(this._url[e]+this.PAPI[e][t].url).split("/"),this[t]=T.bind(this,this.PAPI[e][t])},N.prototype.loadTimeDelta=function(){var i=u.defer();return this.timeDelta?i.resolve():this.getServerTime().then(function(e){var t=new Date(e.timestamp),n=new Date;this.timeDelta=t-n,i.resolve()}.bind(this)).catch(function(e){console.error(e),i.fail(e)}),i.promise},N.prototype.config=function(e){this._appKey=e.appKey||this._appKey,this._sessionId=e.sessionId||this._sessionId,this._sessionSecret=e.sessionSecret||this._sessionSecret,localStorage["SinchSDK-"+this._appKey+"-"+this.user.userId]=this._sessionId},N.prototype.loadSessionId=function(){this._sessionId=localStorage["SinchSDK-"+this._appKey+"-"+this.user.userId]||""},N.prototype.log=function(e,t){t&&t.notify(e),this._logHandler(e)},N.prototype.logMxp=function(e){this._logMxpHandler(e)},N.prototype.setUrl=function(e){this._url.user=e.user||this._url.user,this._url.base=e.base||this._url.base,this._url.portal=e.portal||this._url.portal,this._url.reporting=e.reporting||this._url.reporting,this._url.reporting_v2=e.reporting_v2||this._url.reporting_v2,this._url.calling=e.calling||this._url.calling,this._url.messaging=e.messaging||this._url.messaging,this._url.verification=e.verification||this._url.verification,this.loadPAPIUrl()},N.prototype.terminate=function(){try{this.mxp&&this.mxp.close(),this.mxp.destroy(),this.mxp&&delete this.mxp,this._sessionId="",this._sessionSecret="",this.messageClient&&this.messageClient.destroy()}catch(e){}},N.prototype.stop=function(){console.error("Stop is deprecated, use terminate() instead!"),this.terminate()},N.prototype.adjustedTime=function(){var e=(new Date).getTime();return new Date(e+(this.timeDelta||0)).toISOString()},N.prototype.signSession=function(e){try{var t="";if(void 0!==e.data){var n="string"!=typeof e.data?JSON.stringify(e.data):e.data;t=he.MD5(n).toString(he.enc.Base64)}e.headers["Content-Type"]=(e.headers["Content-Type"]||"").replace("utf-8","UTF-8").replace("/json;chars","/json; chars"),e.headers["X-Timestamp"]=e.headers["X-Timestamp"]||this.adjustedTime();var i=e.method+"\n"+t+"\n"+(e.headers["Content-Type"]||"")+"\nx-timestamp:"+e.headers["X-Timestamp"]+"\n"+e.url.match(/^https?:\/\/[^\/]+([^#]*)/)[1];if(0<this._sessionId.length&&0<this._sessionSecret.length){var r=he.HmacSHA256(he.enc.Utf8.parse(i),he.enc.Base64.parse(this._sessionSecret)).toString(he.enc.Base64);e.headers.Authorization="instance "+this._sessionId+":"+r}else e.headers.Authorization="application "+this._appKey;return e.headers}catch(e){throw e}return null},N.prototype.signTicket=function(e,t){return t=t||e.data.authorization,e.headers=e.headers||{},e.headers.Authorization="user "+t,e.headers["X-Timestamp"]=this.adjustedTime(),e.headers},N.prototype.signApp=function(e){try{return e.headers["X-Timestamp"]=e.headers["X-Timestamp"]||this.adjustedTime(),e.headers.Authorization="application "+this._appKey,e.headers}catch(e){throw e}return null},N.prototype.getSession=function(){return{userId:this.user.userId,sessionId:this._sessionId,sessionSecret:this._sessionSecret,pushNotificationDisplayName:this.user.pushNotificationDisplayName}},N.prototype.newUser=function(e,t,n){var i=u.defer();return t=t||function(e){return console.info("User successfully created"),e},n=n||function(e){console.error(e)},this.user.create(e).then(t).then(i.resolve).fail(function(e){this.log(e),n(e),i.reject(e)}.bind(this)),i.promise},N.prototype.start=function(e,t,n){var i=u.defer();if(t=t||function(){this.log(new Notification(0,1,"SinchClient started"))}.bind(this),n=n||function(e){console.error(e)},this.started){var r=new Error("Sinch client already started");n(r),i.reject(r)}else e&&(this.user.pushNotificationDisplayName=e.pushNotificationDisplayName),this.started=!0,this.loadTimeDelta().then(function(e){return this.log(new Notification(0,5,"Get authentication token"),i),this.user.authenticate(e)}.bind(this,e),e).then(function(e){return this.loadSessionId(),e}.bind(this)).then(function(e){return this.log(new Notification(1,5,"Get instance using auth token"),i),e&&e.sessionId&&e.sessionSecret?this.user.resumeSession(e):this.user.initSessKeySecret()}.bind(this)).fail(function(e){if(40400===((e||{response:{}}).response||{}).errorCode)return this.log(new Notification(1,5,"Invalid instance. Will try again without any pre-set instance ID."),i),this._sessionId="",this.user.initSessKeySecret();throw e}.bind(this)).then(function(){return this.log(new Notification(2,5,"Get MXP configuration"),i),this.user.getMXPConf()}.bind(this)).then(function(){this.log(new Notification(3,5,"Create MXP object"),i),this.mxp=new se(this)}.bind(this)).then(function(){if(this._autoStartMxp&&(void 0!==this.messageClient||void 0!==this.callClient))return this.log(new Notification(4,5,"Will start active connection"),i),this.startActiveConnection();this.log(new Notification(4,5,"Will NOT start active connection. This will prevent IM and incoming data calls."),i)}.bind(this)).then(t).then(function(){this.log(new Notification(5,5,"Successfully started SinchClient"),i),i.resolve()}.bind(this)).fail(function(e){this.started=!1,this._sessionId="",this._sessionSecret="",this.log(e),n(e),i.reject(e)}.bind(this));return i.promise},N.prototype.getMessageClient=function(){if("messaging"in this.capabilities&&this.capabilities.messaging)return this.messageClient;throw new SinchError(f,I,"No messaging capability, not possible to retrieve messageClient")},N.prototype.getCallClient=function(){if("calling"in this.capabilities&&this.capabilities.calling)return this.callClient;throw new SinchError(f,I,"No calling capability, not possible to retrieve callClient")},N.prototype.createSmsVerification=function(e,t){return new ee(this,e,t,"sms")},N.prototype.createCalloutVerification=function(e,t){return new X(this,e,t)},N.prototype.createFlashCallVerification=function(e,t){return new ee(this,e,t,"flashcall")},N.prototype.createVerification=function(e,t,n){return new ee(this,e,t,n.toLowerCase())},N.prototype.startActiveConnection=function(){if(this._onlineCapability&&this.started)return this.log(new Notification(4,5,"Manually starting active connection")),this.mxp.init();if(!this._onlineCapability)throw new SinchError(f,I,'No online capability, can not start active connection. Set configuration option "supportActiveConnection" to "true" when instantiating the SinchClient');this._autoStartMxp=!0},N.prototype.stopActiveConnection=function(){if(this._onlineCapability)return this.log(new Notification(4,5,"Manually closing active connection")),this.mxp.close();throw new SinchError(f,I,'No online capability, can not start active connection. Set configuration option "supportActiveConnection" to "true" when instantiating the SinchClient')},N.prototype.getVersion=function(){try{return r.version[1]}catch(e){return"dev"}},N.prototype.onnotification=function(e,t){};var j,D,R,L=L||{};function U(i,e,t){this.sinch=i,this.eventListeners=[],this.callId=t||O(),this.callDomain="None",this.callOutbound=void 0,this.fromId="",this.toId="",this.webRtcConfig={iceServers:[{urls:["stun:23.21.150.121","stun:stun.l.google.com:19302"]}]};var n=navigator.userAgent.match(/Chrom[e|ium]\/([0-9]+)\./),r=!!n&&parseInt(n[1],10),s=navigator.userAgent.match(/Firefox\/([0-9]+)\./),o=!!s&&parseInt(s[1],10);(48<=r||42<=o)&&(this.sinch.log(new Notification(0,1,"Chrome >= 48 or FF >= 42 detected, will generate certificate manually for better compatibility")),j.generateCertificate({name:"ECDSA",namedCurve:"P-256"}).then(function(e){this.sinch.log(new Notification(0,1,"New certificate generated and configured!")),this.webRtcConfig.certificates=[e]}.bind(this))),this.outgoingStream=void 0,this.outgoingStreamURL=void 0,this.incomingStream=void 0,this.incomingStreamURL=void 0,this.earlymedia=void 0,this.callState=G.INITIATING,this.callEndCause=J.NONE,this.timeProgressing=null,this.timeEstablished=null,this.timeEnded=null,this.error=null,this.autoAnswer=!1,this.autoHangup=!1,this.videoSupport=e||!1,this.clientMap={},this.instanceMap={},this.sdpMap={},this.iceMapRx={},this.iceMapTx=[],this.activeInstance=void 0,this.pcMap={},this.dataChannels={},this.proxyUrl=void 0,this.customHeaders=void 0,this.sdpAnswerBuffer={},this.joinBuffer={};var a={onCallEnded:function(e){this.sinch.mxp.unsubscribe("signalPubNub")}.bind(this)};this.addEventListener(a);var c="web",u="0";try{c=A().split("/")[0],u=A().split("/")[1]}catch(e){}var h={onCallEnded:function(e){var t=e.getDetails();if(t.startedTime){var n={callId:e.callId,domain:e.callDomain,outbound:e.callOutbound,fromId:e.fromId,toId:e.toId,callTime:new Date(t.startedTime).toISOString(),duration:t.duration,setupDuration:(e.timeEstablished-e.timeProgressing)/1e3||0,result:e.callEndCause,deviceInformation:{ModelId:P()||"unknown",OSName:c,OSVersion:u,SDKPlatform:"js",SDKPlatformVersion:i.getVersion()}};e.sinch.callReporting(n).fail(function(){console.error("Could not report call!")})}e.ffIceTimer&&clearInterval(e.ffIceTimer)}};this.addEventListener(h)}function H(e,t,n,i,r){this._version=e,this._type=t,this._sessionId=n,this._created=i,this._externalId=r,this._bytes=[],this.Encoded=function(){return this.encodeChar(this._version),this.encodeChar(this._type),this.encodeSessionId(this._sessionId),this.encodeTimestamp(this._created/1e3),this.encodeChar(this.getUserIdTypeAndLength(0,this._externalId.length)),this.encodeString(this._externalId),this.base64Encode()},this.encodeChar=function(e){this._bytes.push(e)},this.encodeSessionId=function(e){var t=0;for(this._bytes.push(e==e.toLowerCase()?1:2);t<e.length;)"-"!=e.substring(t,t+1)?(this._bytes.push(parseInt(e.substr(t,2),16)),t+=2):++t},this.encodeTimestamp=function(e){this.encodeChar(255&e),this.encodeChar((65280&e)>>8),this.encodeChar((16711680&e)>>16),this.encodeChar((4278190080&e)>>24)},this.encodeString=function(e){for(var t=0;t<e.length;++t)this._bytes.push(e.charCodeAt(t))},this.getUserIdTypeAndLength=function(e,t){return 127&t|e<<7},this.base64Encode=function(){for(var e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),n=this._bytes,i="",r=0;r<n.length;r+=3)i+=t[n[r]>>2],i+=t[(3&n[r])<<4|n[r+1]>>4],void 0!==n[r+1]?i+=t[(15&n[r+1])<<2|n[r+2]>>6]:i+="=",void 0!==n[r+2]?i+=t[63&n[r+2]]:i+="=";for(e=i.slice(0,64),r=1;r<Math.ceil(i.length/64);r++)e+=i.slice(64*r,64*r+64)+(Math.ceil(i.length/64)==r+1?"":"\n");return e}}function z(e){this.endCause=e.endCause,this.endedTime=e.endedTime,this.error=e.error,this.establishedTime=e.establishedTime,this.startedTime=e.startedTime,this.duration=e.duration}function F(e,t){if(!(e instanceof N))throw new Error("CallClient can't be instantiated, use getCallClient in an SinchClient instance");var n=navigator.userAgent.toLowerCase();if(-1<n.indexOf("msie")||/Apple Computer/.test(navigator.vendor)||/Edge/.test(n))throw new Error("SinchClient can't be started with calling capability. Browser not supported.");this.sinch=e,this.eventListeners=[],this.callBuffert={},this.localMediaStream=void 0,this.incomingCallCustomStream=t,this.groupChannel=void 0}j=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||L.RTCPeerConnection,D=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||L.RTCSessionDescription,R=window.RTCIceCandidate||window.mozRTCIceCandidate||L.RTCIceCandidate,U.prototype.addEventListener=function(e){this.eventListeners.push(e)},U.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},U.prototype.setStream=function(e){this.outgoingStream=e,this.outgoingStreamURL=window.URL.createObjectURL(e),this.execListener("onLocalStream",e)},U.prototype.execListener=function(n,i){this.eventListeners.forEach(function(e){try{return e[n]&&e[n](this,i)}catch(e){var t=new SinchError(f,I,"Error executing listener: "+n,e);throw console.error(t),t}}.bind(this))},U.prototype.setEndCause=function(e){this.callEndCause===J.NONE&&(this.callEndCause=e)},U.prototype.setParticipants=function(e,t){this.callOutbound=e==this.sinch.user.userId,this.toId=t,this.fromId=e},U.prototype.progress=function(e){if(this.callState!=G.INITIATING)throw new SinchError(l,w,"Progress: Invalid call state for progressing",U);this.sinch.log(new Notification(0,1,"Call changing state to PROGRESSING")),this.timeProgressing=new Date,this.callState=G.PROGRESSING,e&&this.execListener("onCallProgressing"),this.autoAnswer&&this.answer(),this.autoHangup&&this.hangup()},U.prototype.establish=function(){if(this.callState==G.PROGRESSING){for(var e in this.sinch.log(new Notification(0,1,"Call changing state to ESTABLISHED")),this.pc=this.pc||this.pcMap[this.activeInstance]||this.pcMap.virtual,delete this.pcMap.virtual,this.pcMap)e!=this.activeInstance&&this.pcMap[e]!=this.pcMap[this.activeInstance]&&(this.pcMap[e]&&"closed"!=this.pcMap[e].signalingState&&this.pcMap[e].close(),delete this.pcMap[e]);"connection"!=this.callDomain&&(this.unmute(),this.incomingStream=this.pc.getRemoteStreams()[0],this.incomingStreamURL=window.URL.createObjectURL(this.incomingStream)),this.timeEstablished=new Date,this.callState=G.ESTABLISHED,this.execListener("onCallEstablished")}else console.log("Call state not in PROGRESSING, cant process second JOIN")},U.prototype.push=function(e){if(!this.sinch._supportManagedPush)return!1;if(this.callState!=G.INITIATING&&this.callState!=G.PROGRESSING)return!1;var t=[];for(ce in this.instanceMap)this.instanceMap[ce].capabilities&&-1<this.instanceMap[ce].capabilities.indexOf("push")&&(!e&&this.instanceMap[ce].capabilities.indexOf("online")<0||e&&-1<this.instanceMap[ce].capabilities.indexOf("online"))&&t.push(ce);if(0<t.length){var n=new H(2,1,this.callId,Date.now(),this.sinch.user.userId),i={};i.sinch=n.Encoded(),this.sinch.user.pushNotificationDisplayName&&(i.displayName=this.sinch.user.pushNotificationDisplayName);for(var r={sessionId:this.callId,template:"incoming_call",to:[],params:i},s=0;s<t.length;++s)r.to.push({instance:t[s]});this.sinch.pushCall({messages:[r]}),this._callPushed=!0,this.progress(!0)}return this._callPushed},U.prototype.createInstanceMap=function(e){if(!e)return null;for(var t={},n=0;n<e.length;++n)t[e[n].instanceId]={},t[e[n].instanceId].capabilities=e[n].capabilities;return t},U.prototype.mxpAck=function(e){if(this.sinch.log(new Notification(0,1,"Call ACK Received",e)),this.callState!=G.INITIATING&&this.callState!=G.PROGRESSING)throw new SinchError(l,w,"Invalid call state for processing Ack",U);this.clientMap[e.getSenderId()]=this.clientMap[e.getSenderId()]||e.getFrom(),this.instanceMap&&this.instanceMap[e.getInstanceId()]&&(this.instanceMap[e.getInstanceId()].acked=!0);for(var t=0;t<this.iceMapTx.length;t++){var n=this.iceMapTx[t];this.sinch.log(new Notification(0,1,"Firefox special: Transmitting buffered ICE candidates for the one Peer Connection we have.",n)),this.sinch.mxp.callTxICECandidate(this,n,e.fi).fail(function(e){throw new SinchError(f,I,"Error sending ICE candidate")})}this.processRTCAnswer(e).then(function(){"yes"===(e.decrypted.nvps||{}).earlymedia?(this.activeInstance=e.getSenderId(),this.progress(!1),this.establish(),this.earlymedia=!0):this.progress(!0),this.joinBuffer[e.getSenderId()]&&(this.sinch.log(new Notification(0,1,"Buffered JOIN was detected for this Ack, will immediatley process & remove.")),this.mxpJoin(this.joinBuffer[e.getSenderId()]),delete this.joinBuffer[e.getSenderId()])}.bind(this))},U.prototype.intProcessAnswer=function(e,t){var n=u.defer();return this.sinch.log(new Notification(2,2,"Will configure SDP Answer",e)),this.pcMap[t].setRemoteDescription(e,function(){this.sinch.log(new Notification(2,2,"Configured incoming SDP Answer",e)),n.resolve()}.bind(this),function(e){throw new SinchError(f,I,"Error setting remote SDP",e)}.bind(this)),n.promise},U.prototype.processRTCAnswer=function(t){var n=u.defer();if(this.callState!=G.ENDED){var e="media"==t.decrypted.bt?null:t.decrypted.bd;this.sinch.log(new Notification(0,2,"Processing SDP Answer from B",e));var i=e?new D(JSON.parse(e)):null;if(this.sinch.firefox)this.pcMap[t.getSenderId()]=this.offerGeneratorPC,this.sdpAnswerBuffer[t.getSenderId()]=RTCdescription,n.resolve();else{this.pcMap[t.getSenderId()]=this.pcMap[t.getSenderId()]||this.initPC();var r=this.pcMap[t.getSenderId()];r.createOffer(function(e){r.setLocalDescription(this.outgoingOffer,function(){this.sinch.log(new Notification(1,2,"Configured cached outgoing SDP Offer",this.outgoingOffer)),i?this.intProcessAnswer(i,t.getSenderId()).then(function(){n.resolve()}):n.resolve()}.bind(this),function(e){console.error("Error setting local Description, message: "+e)})}.bind(this),function(e){console.error("Error creating offer, message: "+e)},{offerToReceiveAudio:!0,offerToReceiveVideo:this.videoSupport})}}else n.resolve();return n.promise},U.prototype.mxpPeerEventSdp=function(t){if(this.callState==G.INITIATING||this.callState==G.PROGRESSING)this.disableIce=!0,this.processRTCAnswer(t);else if(this.callState==G.ESTABLISHED){var e=JSON.parse(t.decrypted.bd);if("offer"==e.type){this.sinch.log(new Notification(0,3,"Got renegotiation SDP Offer",e));var n=new D(e);this.pc.setRemoteDescription(n,function(){this.sinch.log(new Notification(1,3,"Successfully configured SDP Offer.",e)),this.pc.createAnswer(function(e){this.pc.setLocalDescription(e,function(){this.sinch.log(new Notification(2,3,"Successfully created SDP Answer.",e)),this.sinch.mxp.callTxPeerEventSDP(this,e,t.getSenderId()).fail(function(e){throw new SinchError(f,I,"Error sending SDP Answer")})}.bind(this),function(e){console.error("Major error in setting local description",e)})}.bind(this),function(e){console.error("Major error in creating answer",e)})}.bind(this),function(e){throw setTimeout(function(){this.setEndCause(J.FAILURE),this.error=new SinchError(f,I,e),this.sinch.mxp.callCancel(this).fail(function(e){throw new SinchError(f,I,"Error sending call Cancel")}),this.callFailure()}.bind(this),2e3),new SinchError(f,I,"Error setting remote SDP")}.bind(this))}else if("answer"==e.type){this.sinch.log(new Notification(0,2,"Got renegotiation SDP Answer",e));n=new D(e);this.pc.setRemoteDescription(n,function(){this.sinch.log(new Notification(1,2,"Configured incoming SDP Answer",e))}.bind(this),function(e){throw setTimeout(function(){this.setEndCause(J.FAILURE),this.error=new SinchError(f,I,e),this.sinch.mxpCancel(this).fail(function(e){throw new SinchError(f,I,"Error sending call Cancel")}),this.callFailure()}.bind(this),2e3),new SinchError(f,I,"Error setting remote SDP")})}}},U.prototype.mxpInjectIce=function(e){if(this.callState!=G.ENDED){this.sinch.log(new Notification(0,2,"Recieved ICE Candidate offer from B",e));var t=JSON.parse(e.decrypted.bd);t.candidate=t.cand||t.candidate,t.sdpMLineIndex=t.sdpMLI||t.sdpMLineIndex;var n=e.getSenderId();!this.sinch.firefox&&n in this.pcMap?(this.sinch.log(new Notification(0,2,"Injecting ICE candidate directly",t)),this.injectIce(n,t)):(this.sinch.log(new Notification(0,2,"Buffering ICE candidate until PeerConnection created",t)),this.iceMapRx[n]=this.iceMapRx[n]||[],this.iceMapRx[n].push(t))}},U.prototype.injectIce=function(e,t){var n=t.candidate.split(" ");if(-1!=n.indexOf("srflx")&&"udp"==n[2].toLowerCase()){var i={candidate:["candidate:"+(123+(this.pcMap[e].proxyIce||[]).length),n[1],n[2].toUpperCase(),Math.round(n[3]/10),this.proxyUrl.split("/")[3].split(":")[0],this.proxyUrl.split("/")[3].split(":")[1],"typ","relay","raddr",n[4],"rport",n[5],"generation",0].join(" "),sdpMLineIndex:"number"==typeof t.sdpMLI?t.sdpMLI:t.sdpMLineIndex||0,sdpMid:t.sdpMid};this.sinch.log(new Notification(0,1,"Generated extra candidate for Proxy Relay",i)),void 0===this.pcMap[e].proxyIce&&(this.pcMap[e].proxyIce=[]),this.pcMap[e].proxyIce.push(new R(i))}this.pcMap[e].addIceCandidate(new R(t),function(){},function(){})},U.prototype.addRelay=function(t){if(0==((this.pcMap[t]||{}).proxyIce||[]).length)if(console.error("Warning, no proxy configured (2). Will try to add candidate without srflx reference",this.pcMap[t]),this.proxyUrl){var e=this.proxyUrl.split("/")[3].split(":");this.pcMap[t].proxyIce=this.pcMap[t].proxyIce||[],this.pcMap[t].proxyIce.push(new R({sdpMid:"audio",sdpMLI:0,sdpMLineIndex:0,candidate:V.generateIceCandidate(e[0],e[1])}))}else console.error("Warning, no proxyUrl configured!");((this.pcMap[t]||{}).proxyIce||[]).forEach(function(e){this.sinch.log(new Notification(0,1,"Adding buffered proxy ICE candidate",e)),this.pcMap[t].addIceCandidate(e,function(){this.sinch.log(new Notification(0,1,"Successfully added proxy ICE candidate",e))}.bind(this),function(e){throw new SinchError(f,I,"Failed to add proxy ICE candidate when processing JOINED",e)})}.bind(this))},U.prototype.mxpJoin=function(i){if(this.sinch.log(new Notification(0,1,"Call JOIN Received",i)),this.activeInstance&&this.activeInstance!=i.getSenderId())throw console.error("Can not process JOIN, call in session after previous JOIN"),new SinchError(a,v,"Can not process JOIN, call in session after previous JOIN");var r=i.getSenderId();this.callState==G.INITIATING?(this.sinch.log(new Notification(0,1,"JOIN received before ACK. Will cache JOIN to process after ACK.")),this.joinBuffer[r]=i):u.fcall(function(){var e=u.defer();if("sdp"===i.decrypted.bt&&this.pcMap[r]&&""==this.pcMap[r].remoteDescription.sdp){var t=JSON.parse(i.decrypted.bd),n=new D(t);this.sinch.firefox?this.sdpAnswerBuffer[r]=n:this.pcMap[r].setRemoteDescription(n,function(){this.sinch.log(new Notification(1,2,"Configured incoming SDP Join",t)),e.resolve()}.bind(this),function(e){throw setTimeout(function(){this.setEndCause(J.FAILURE),this.error=new SinchError(f,I,e),this.sinch.mxpCancel(this).fail(function(e){throw new SinchError(f,I,"Error sending call Cancel")}),this.callFailure()}.bind(this),2e3),new SinchError(f,I,"Error setting remote SDP")})}else e.resolve();return e.promise}.bind(this)).then(u.fcall(function(){var t=u.defer();if(this.sinch.firefox&&this.sdpAnswerBuffer[r]){var e=this.sdpAnswerBuffer[r];this.intProcessAnswer(e,i.getSenderId()).then(function(){for(;(this.iceMapRx[r]||[]).length;){var e=this.iceMapRx[r].pop();this.injectIce(i.getSenderId(),e),this.sinch.log(new Notification(0,1,"Injected ice from Ice Rx buffert",e))}setTimeout(function(){t.resolve()}.bind(this),200)}.bind(this))}else t.resolve();return t.promise}.bind(this)).then(function(){if(this.pcMap[r]&&(this.sinch.log(new Notification(0,1,"Remote description:",this)),this.pcMap[r].remoteDescription&&this.pcMap[r].remoteDescription.sdp.includes("a=candidate:")||this.addRelay(r)),this.callState!=G.PROGRESSING&&!this.earlymedia)throw console.error("Can not process JOIN, call in unexpected state. Call state: "+this.getState()),new SinchError(f,I,"Can not process JOIN, call in unexpected state.");this.activeInstance=i.getSenderId(),this.sinch.mxp.callJoined(this).then(function(){this.sinch.log(new Notification(0,1,"Successfully sent JOINED",this)),this.earlymedia||this.establish()}.bind(this)).fail(function(e){console.error("Unhandled error in call.mxpJoin.",e)})}.bind(this))).fail(function(e){console.error("Error processing JOIN",e)})},U.prototype.mxpJoined=function(e){if(this.sinch.log(new Notification(0,1,"Call JOINED Received",e)),this.callState==G.INITIATING||this.callState==G.PROGRESSING){if(JSON.parse(e.decrypted.bd).fi!=this.sinch._sessionId+":"+this.sinch._subInstanceId)this.setEndCause(J.OTHER_DEVICE_ANSWERED),this.mxpHangup();else if(this.callState==G.PROGRESSING){var t=e.getSenderId();if(this.sinch.firefox)for(;(this.iceMapRx[t]||[]).length;){var n=this.iceMapRx[t].pop();this.injectIce(e.getSenderId(),n),this.sinch.log(new Notification(0,1,"Injected ice from Ice Rx buffert",n))}this.addRelay(t),this.establish()}}else console.log("Call state already ESTABLISHED (or ENDED), cant process second JOIN")},U.prototype.mxpHangup=function(e){if(this.callState!=G.ENDED)for(var t in this.sinch.log(new Notification(0,1,"Call HANGUP Received",e)),this.callState==G.ESTABLISHED?this.setEndCause(J.HUNG_UP):this.setEndCause(J.CANCELED),this.timeEnded=new Date,this.callState=G.ENDED,this.execListener("onCallEnded"),this.pc&&"closed"!=this.pc.signalingState&&this.pc.close(),delete this.pc,this.pcMap)delete this.pcMap[t]},U.prototype.mxpDeny=function(e){if(this.callState!=G.ENDED){if(this.sinch.log(new Notification(0,1,"Call DENIED Received",e)),this.setEndCause(J.DENIED),"error/json"==e.decrypted.bt){this.error=new SinchError(h,b,"");var t=JSON.parse(e.decrypted.bd);for(var n in t)this.error[n]=t[n];this.error.message=t.code+" "+t.reason,this.error.mxp=e.decrypted}this.callState==G.INITIATING?(this.autoHangup=!0,this.progress(!0)):this.hangup()}},U.prototype.mxpCancel=function(e){if(this.callState!=G.ENDED){this.sinch.log(new Notification(0,1,"Call CANCEL Received",e)),this.timeEnded=new Date,this.callState=G.ENDED;Date.now();for(var t in this.setEndCause(J.CANCELED),this.execListener("onCallEnded"),this.pc&&"closed"!=this.pc.signalingState&&this.pc.close(),delete this.pc,this.pcMap)delete this.pcMap[t]}},U.prototype.mxpFail=function(e){if(this.sinch.log(new Notification(0,1,"Call FAILURE Received",e)),"message"==e.decrypted.bt)this.error=new SinchError(h,b,""),this.error.message=e.decrypted.bd,this.error.mxp=e.decrypted;else if("error/json"==e.decrypted.bt){this.error=new SinchError(h,b,"");var t=JSON.parse(e.decrypted.bd);for(var n in t)this.error[n]=t[n];this.error.message=t.code+" "+t.reason,this.error.mxp=e.decrypted}this.callFailure()},U.prototype.callFailure=function(){for(var e in this.timeEnded=new Date,this.callState=G.ENDED,this.setEndCause(J.FAILURE),this.execListener("onCallEnded"),this.pc&&"closed"!=this.pc.signalingState&&this.pc.close(),delete this.pc,this.pcMap)delete this.pcMap[e]},U.prototype.addEventListenerPrototype=function(e){e.onOpen&&(this.onopen=e.onOpen),e.onClose&&(this.onclose=e.onClose),e.onMessage&&(this.onmessage=e.onMessage)},U.prototype.initPC=function(e){var i=new j(this.webRtcConfig,{optional:[{DtlsSrtpKeyAgreement:!0}]});return this.outgoingStream&&"connection"!=this.callDomain?(this.mute(),i.addStream(this.outgoingStream)):(this.sinch.log(new Notification(0,1,"WebRTC: Will add data channel before ICE negotiation")),this.dataChannels[this.sinch.user.userId]=i.createDataChannel(this.sinch.user.userId,{reliable:!1}),this.dataChannels[this.sinch.user.userId].onmessage=function(e){console.log("fallback",e)},this.dataChannels[this.sinch.user.userId].addEventListener=this.addEventListenerPrototype.bind(this.dataChannels[this.sinch.user.userId])),i.ontrack=function(e){this.execListener("onRemoteTrack",this.incomingStream)}.bind(this),i.ondatachannel=function(e){this.sinch.log(new Notification(0,1,"WebRTC: Datachannel opened",e));try{this.dataChannels[e.channel.label]=e.channel,this.dataChannels[e.channel.label].addEventListener=this.addEventListenerPrototype.bind(this.dataChannels[e.channel.label]),this.execListener("onDataChannelAdded",this.dataChannels[e.channel.label])}catch(e){console.error("Error handling datachannel",e)}}.bind(this),i.oniceconnectionstatechange=function(e){this.sinch.log(new Notification(0,1,"WebRTC: Connection state changed",e)),this.renegotiate||!e.currentTarget||"failed"!=e.currentTarget.iceConnectionState&&"disconnected"!=e.currentTarget.iceConnectionState||(this.sinch.log(new SinchError(o,g,"Ice connection failed. Hanging up call!",e)),this.hangup())}.bind(this),i.onicecandidate=function(e){if(!this.renegotiate&&e.candidate){this.sinch.log(new Notification(0,2,"Preparing ICE candidate for B",e.candidate));var t=Object.keys(this.pcMap).filter(function(e){return this.pcMap[e]===i}.bind(this))[0],n={cand:e.candidate.candidate,candidate:e.candidate.candidate,sdpMLI:e.candidate.sdpMLineIndex,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid||""};setTimeout(function(){t?this.disableIce?this.sinch.log(new Notification(1,2,"ICE Disabled, will not send any ICE candidates (will be sent in different way)",n)):(this.sinch.log(new Notification(1,2,"Instantly sending ICE candidate for B",n)),this.sinch.mxp.callTxICECandidate(this,n,t).fail(function(e){throw new SinchError(f,I,"Error sending ICE candidate")})):this.iceMapTx.push(n)}.bind(this),this.sinch.mxp.sessionBuffert[this.callId]?0:500)}}.bind(this),i.onnegotiationneeded=function(e){this.callState==G.ESTABLISHED&&(this.renegotiate=!0,this.sinch.log(new Notification(0,2,"Negotiation needed, will generate new offer",e)),i.createOffer(function(e){this.sinch.log(new Notification(1,2,"Negotiation needed, offer generated",e)),i.setLocalDescription(this.outgoingOffer,function(){this.sinch.log(new Notification(1,2,"Negotiation needed, sending offer to recipient",e)),this.sinch.mxp.callTxPeerEventSDP(this,e,this.activeInstance).fail(function(e){throw new SinchError(f,I,"Error sending SDP Offer")})}.bind(this),function(e){this.sinch.log(new Notification(0,2,"Error setting local description",e))})}.bind(this),function(e){this.sinch.log(new Notification(0,2,"Error generating new offer",e))}))}.bind(this),i.onremovestream=function(e){this.sinch.log(new Notification(0,1,"WebRTC: Stream removed",e))}.bind(this),i.onsignalingstatechange=function(e){this.sinch.log(new Notification(0,1,"WebRTC: Signaling state change",e))}.bind(this),i.onidentityresult=function(e){this.sinch.log(new Notification(0,1,"WebRTC: onidentityresult event detected",e))},i.onidpassertionerror=function(e){this.sinch.log(new Notification(0,1,"WebRTC: onidpassertionerror event detected",e))},i.onidpvalidationerror=function(e){this.sinch.log(new Notification(0,1,"WebRTC: onidpvalidationerror event detected",e))},i.onpeeridentity=function(e){this.sinch.log(new Notification(0,1,"WebRTC: onpeeridentity event detected",e))},i},U.prototype.placeCall=function(n,e){var i=u.defer();this.callDomain=e,this.setParticipants(this.sinch.user.userId,n),setTimeout(function(){this.push(!0),this._callPushed||this.callState!=G.INITIATING||(this.sinch.log(new Notification(0,1,"Call PROGRESSING timeout. Will hangup call.",this)),this.setEndCause(J.TIMEOUT),this.hangup())}.bind(this),this.sinch._progressTimeout||K),setTimeout(function(){this.callState==G.PROGRESSING&&(this.sinch.log(new Notification(0,1,"Call ESTABLISHED timeout. Will hangup call.",this)),this.setEndCause(J.NO_ANSWER),this.hangup())}.bind(this),W);var r={cli:"",destination:{type:{pstn:"number",data:"username",conference:"username",connection:"username",sip:"username"}[e],endpoint:n},callId:this.callId,mediaChannels:["audio"],subinstanceId:this.sinch._subInstanceId,headers:{p2p:"yes"},domain:{pstn:"pstn",data:"data",conference:"conference",connection:"data",sip:"sip"}[e]};this.sinch._supportVideo&&r.mediaChannels.push("video"),this.customHeaders&&(r.headers.ph=JSON.stringify(this.customHeaders)),"connection"==e&&(r.headers.nomedia=!0);var s=this.initPC();return s.createOffer(function(t){this.outgoingOffer=t,r.sdp=t,this.sinch.placeCall(r).then(function(e){this.sinch.log(new Notification(0,1,"Successfully initiated call, waiting for MXP signalling.",e)),void 0!==e.SignalChannel&&null!==e.SignalChannel&&(this.clientMap.virtual={fs:e.SignalChannel,fu:n},this.instanceMap=this.createInstanceMap(e.instances),this.push(!1)&&(_callPushed=!0)),this.proxyUrl=e.Body.replace(/(\r\n|\n|\r)/gm,""),this.sinch.firefox&&(this.offerGeneratorPC=s).setLocalDescription(t,function(){this.sinch.log(new Notification(0,1,"Firefox special: Configuring the local description to gather ICE candidates.",t))}.bind(this),function(e){throw new SinchError(f,I,"Firefox special: Error configuring local description",e)}),this.sinch.mxp.configureMxpSession(this.callId,e.EncryptionKey,e.Body),i.resolve()}.bind(this)).fail(function(e){this.error=new SinchError(f,I,JSON.parse(e.response).message),this.callFailure(),i.reject(error)}.bind(this))}.bind(this),function(e){console.error("Failed to generate SDP Offer"),console.error(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:this.videoSupport}),i.promise},U.prototype.updateSdp=function(e){for(var t=e.split("\n"),n="",i=!1,r=!1,s=0;s<t.length;++s)0<t[s].length&&!t[s].startsWith("a=crypto:1")&&(n=n+t[s]+"\n"),0<t[s].length&&t[s].startsWith("a=mid:")&&(r=!0),0<t[s].length&&t[s].startsWith("a=group:BUNDLE")&&(i=!0);return i||(n+="a=group:BUNDLE audio\n"),r||(n+="a=mid:audio\n"),n},U.prototype.ackIncomingCall=function(n){var e=u.defer();this.sinch.log(new Notification(0,1,"Incoming call",this)),setTimeout(function(){this.callState==G.INITIATING&&(this.sinch.log(new Notification(0,1,"Call PROGRESSING timeout. Will hangup call.",this)),this.setEndCause(J.TIMEOUT),this.hangup())}.bind(this),K),setTimeout(function(){this.callState==G.PROGRESSING&&(this.sinch.log(new Notification(0,1,"Call ESTABLISHED timeout. Will hangup call.",this)),this.setEndCause(J.NO_ANSWER),this.hangup())}.bind(this),W);var t=JSON.parse(n.decrypted.nvps.sdp);t.sdp=this.updateSdp(t.sdp),this.sinch.log(new Notification(0,1,"Received SDP offer from B",t));var i=new D(t),r=this.initPC();return this.pcMap[n.getSenderId()]=r,(this.pc=r).setRemoteDescription(i,function(){for(this.sinch.log(new Notification(1,3,"Successfully configured SDP Offer.",t));(this.iceMapRx[this.activeInstance]||[]).length;){var e=this.iceMapRx[this.activeInstance].pop();this.injectIce(n.getSenderId(),e),this.sinch.log(new Notification(0,1,"Injected ice from Ice Rx buffert",e))}r.createAnswer(function(t){r.setLocalDescription(t,function(){if(this.sinch.log(new Notification(2,3,"Successfully created SDP Answer.",t)),this.progress(!1),"yes"==n.decrypted.nvps.p2p)this.sinch.log(new Notification(2,3,"Header detected, p2p, will proceed with direct peer connection!.",n)),this.sinch.mxp.sendSdpAnswer(this,t).fail(function(e){throw new SinchError(f,I,"Error sending SDP Answer")});else{this.disableIce=!0,this.sinch.log(new Notification(2,3,"p2p header not detected, will fall back on proxy, we might deal with an old client",n)),this.mediaObj={callid:this.callId,proxyid:n.decrypted.bd.split("/")[2],sdp:t},this.sinch.mxp.sendSdpAnswer(this);var e=n.decrypted.bd.split("/")[3].split(":");r.proxyIce=r.proxyIce||[],r.proxyIce.push(new R({sdpMid:"audio",sdpMLI:0,sdpMLineIndex:0,candidate:V.generateIceCandidate(e[0],e[1])}))}}.bind(this),function(e){console.error("Major error in setting local description",e)})}.bind(this),function(e){console.error("Major error in creating answer",e)})}.bind(this),function(e){throw setTimeout(function(){this.setEndCause(J.FAILURE),this.error=new SinchError(f,I,e),this.sinch.mxp.callCancel(this).fail(function(e){throw new SinchError(f,I,"Error sending call Cancel")}),this.callFailure()}.bind(this),2e3),new SinchError(f,I,"Error setting remote SDP")}.bind(this)),e.promise},U.prototype.answer=function(){if(this.sinch.log(new Notification(0,1,"Answer call initiated, to answer()",this)),this.callState==G.PROGRESSING)this.mediaObj?this.sinch.postMedia(this.mediaObj).then(function(e){var t="audio:ISAC/0.0.0.0/"+e.proxyid+"/"+e.ip+":"+e.port;this.sinch.mxp.joinIncomingCall(this,t).then(function(){this.sinch.log(new Notification(3,3,"Successfully sent updated proxy information in Ack to caller",t))}.bind(this)).fail(function(e){throw console.error(e),new SinchError(f,I,"Could not send Ack to Old with MEDIA answer")})}.bind(this)).fail(function(e){throw console.error(e),new SinchError(f,I,"Could not send Answer to v1/media")}):this.sinch.mxp.joinIncomingCall(this).fail(function(e){throw new SinchError(f,I,"Error sending JOIN (pickup phone).")});else if("undefined"==typeof outgoingStream)this.sinch.log(new Notification(0,1,"Outgoing stream undefined, perhaps early answer. Will set auto answer for future automatic answer.")),this.autoAnswer=!0;else{if(this.callState==G.ENDED||this.callState==G.ESTABLISHED)throw new SinchError(f,I,"Call in invalid state to answer.");this.sinch.log(new Notification(0,1,"Stream defined and state in initializing or progressing. Setting auto answer for later retry.")),this.autoAnswer=!0}},U.prototype.openDataChannel=function(e){return void 0===this.dataChannels[e]&&(this.dataChannels[e]=this.pcMap[this.activeInstance].createDataChannel(e,{reliable:!1}),this.dataChannels[e].addEventListener=this.addEventListenerPrototype.bind(this.dataChannels[e]),this.execListener("onDataChannelAdded",this.dataChannels[e])),this.dataChannels[e]},U.prototype.hangup=function(){if(this.hangupRetries=(this.hangupRetries||0)+1,this.callState==G.ESTABLISHED)this.sinch.mxp.callHangup(this).fail(function(e){throw new SinchError(f,I,"Error sending call Hangup")}),this.mxpHangup();else if(!this.callOutbound||this.callState!=G.PROGRESSING&&this.callState!=G.INITIATING)if(this.callOutbound||this.callState!=G.PROGRESSING&&this.callState!=G.INITIATING){if(this.callState==G.ENDED)throw new SinchError(f,I,"Call already ended");this.mxpHangup()}else this.callState==G.PROGRESSING?(this.sinch.mxp.callDeny(this).fail(function(e){throw new SinchError(f,I,"Error sending call Deny")}),this.setEndCause(J.DENIED),this.mxpHangup()):this.autoHangup=!0;else 0<Object.keys(this.clientMap).length||5<this.hangupRetries?(this.sinch.mxp.callCancel(this).fail(function(e){throw new SinchError(f,I,"Error sending call Cancel")}),this.mxpHangup()):(this.sinch.log(new Notification(0,1,"Can not hang up call at this time. Will try again in 0.5 seconds (max five retries).")),setTimeout(this.hangup.bind(this),500))},U.prototype.getCallId=function(){return this.callId},U.prototype.getDetails=function(){return new z({endCause:this.callEndCause,endedTime:this.timeEnded,error:this.error,establishedTime:this.timeEstablished,startedTime:this.timeProgressing,duration:this.timeEstablished?(this.timeEnded-this.timeEstablished)/1e3:0})},U.prototype.getDirection=function(){return this.callOutbound?1:0},U.prototype.getRemoteUserId=function(){return this.getDirection()?this.toId:this.fromId},U.prototype.getState=function(){return Object.keys(G).filter(function(e){return G[e]===this.callState}.bind(this))[0]},U.prototype.getEndCause=function(){return Object.keys(J).filter(function(e){return J[e]===this.callEndCause}.bind(this))[0]},U.prototype.getHeaders=function(){return this.customHeaders},U.prototype.sendDTMF=function(e){return this.DTMFsender||(this.DTMFsender=this.pc.createDTMFSender(this.outgoingStream.getAudioTracks()[0])),this.DTMFsender&&this.DTMFsender.insertDTMF(e)},U.prototype.mute=function(){if(this.callState!=G.ESTABLISHED&&this.callState!=G.PROGRESSING&&this.callState!=G.INITIATING)throw new SinchError(f,I,"Call not in ESTABLISHED state.");this.sinch.log(new Notification(0,1,"Call was muted using mute()."));for(var e=this.outgoingStream.getAudioTracks(),t=0;t<e.length;t++)e[t].enabled=!1},U.prototype.unmute=function(){if(this.callState!=G.ESTABLISHED&&this.callState!=G.PROGRESSING&&this.callState!=G.INITIATING)throw new SinchError(f,I,"Call not in ESTABLISHED state.");this.sinch.log(new Notification(0,1,"Call was un-muted using unmute()."));for(var e=this.outgoingStream.getAudioTracks(),t=0;t<e.length;t++)e[t].enabled=!0},navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia),F.prototype.addEventListener=function(e){this.eventListeners.push(e)},F.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},F.prototype.execListener=function(t,n){var i=0;return this.eventListeners.forEach(function(e){return i++,e[t]&&e[t](n)}.bind(this)),i},F.prototype.initStream=function(e,t){var n=u.defer(),i=!(!this.sinch._supportVideo||t)&&{mandatory:{maxWidth:320,maxHeight:240}};return void 0!==e?(this.sinch.log(new Notification(0,1,"Will wire customStream into call",e)),n.resolve(e)):void 0===this.localMediaStream?(this.sinch.log(new Notification(0,1,"Will retrieve new Mic for stream")),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({video:i,audio:!0}).then(function(e){this.localMediaStream=e,n.resolve(this.localMediaStream)}).catch(function(e){console.error("Error retrieving media stream",e)})):(this.sinch.log(new Notification(0,1,"Will retrieve cached Mic for stream",this.localMediaStream)),n.resolve(this.localMediaStream)),n.promise},F.prototype.alreadyInCall=function(){if(this.sinch._multiCall)return!1;for(var e in this.callBuffert)if(this.callBuffert[e].callState==G.PROGRESSING||this.callBuffert[e].callState==G.ESTABLISHED)return!0},F.prototype.handleIncomingCall=function(t){this.sinch.log(new Notification(0,1,"Will handle incoming call",t));var e,n=new U(this.sinch,this.sinch._supportVideo,t.mxpSessionId);(t.decrypted.nvps||{}).nomedia?n.callDomain="connection":n.callDomain="data",n.setParticipants(t.decrypted.fu,this.sinch.user.userId),n.customHeaders=JSON.parse((t.decrypted.nvps||{}).ph||"{}"),this.sinch.mxp.configureMxpSession(n.callId,t.decrypted.nvps.key,t.decrypted.bd),n.clientMap[t.getSenderId()]=t.getFrom(),this.callBuffert[n.callId]=n,this.alreadyInCall()?(this.sinch.log(new Notification(0,1,"Already in a call, will hangup incoming call.",t)),this.sinch.mxp.subscribe("signalPubNub").then(function(){this.sinch.mxp.callDeny(n)}.bind(this))):this.execListener("onIncomingCall",n)?("connection"==n.callDomain?(e=u.defer(),e.resolve(null),e.promise):this.initStream(this.incomingCallCustomStream)).then(function(e){return this.execListener("onMediaStream",e),this.sinch.mxp.subscribe("signalPubNub").then(function(){(t.decrypted.nvps||{}).nomedia||n.setStream(e),n.activeInstance=t.getSenderId(),n.proxyUrl=t.decrypted.bd.replace(/(\r\n|\n|\r)/gm,""),n.ackIncomingCall(t).catch(function(e){console.error("Error handling incoming call",e)})}.bind(this))}.bind(this)):this.sinch.log(new SinchError(f,C,"Missing handler, onIncomingCall."))},F.prototype.callUser=function(t,e,n){this.sinch.log(new Notification(0,1,"CallUser method called",t));var i=new U(this.sinch,this.sinch._supportVideo);return i.customHeaders=e,this.initStream(n).then(function(e){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=G.INITIATING)throw new SinchError(f,I,"Error executing user call. Incorrect call state.");i.setStream(e),i.placeCall(t,"data"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},F.prototype.callSip=function(t,e,n){this.sinch.log(new Notification(0,1,"CallSip method called",t));var i=new U(this.sinch);return i.customHeaders=e,this.initStream(n).then(function(e){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=G.INITIATING)throw new SinchError(f,I,"Error executing user call. Incorrect call state.");i.setStream(e),i.placeCall(t,"sip"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},F.prototype.connect=function(e,t){this.sinch.log(new Notification(0,1,"connect method called",e));var n=new U(this.sinch);return n.customHeaders=t,this.sinch.mxp.subscribe("signalPubNub").then(function(){if(n.callState!=G.INITIATING)throw new SinchError(f,I,"Error executing connect. Incorrect call state.");n.placeCall(e,"connection"),this.callBuffert[n.callId]=n}.bind(this)),n},F.prototype.callPhoneNumber=function(t,e,n){this.sinch.log(new Notification(0,1,"CallPhoneNumber method called",t));var i=new U(this.sinch);return i.customHeaders=e,this.initStream(n,!0).then(function(e){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=G.INITIATING)throw new SinchError(f,I,"Error executing user call. Incorrect call state.");i.setStream(e),i.placeCall(t,"pstn"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},F.prototype.callConference=function(t,e,n){if(this.sinch.log(new Notification(0,1,"CallConference method called",t)),!(t=""+t)||64<t.length)throw new SinchError(f,x,"Invalid conferenceId. Must be alphanumeric string less than 64 characters in length.");var i=new U(this.sinch);return i.customHeaders=e,this.initStream(n,!0).then(function(e){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=G.INITIATING)throw new SinchError(f,I,"Error executing user call. Incorrect call state.");i.setStream(e),i.placeCall(t,"conference"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},F.prototype.callGroup=function(e){if(this.sinch.log(new Notification(0,1,"callRoom method called, for group",e)),void 0!==this.groupChannel)throw new SinchError(f,I,"Can not call room, already in a room");if(!this.sinch._multiCall)throw new SinchError(f,I,"Can not call room, multiCall capability not specified");return this.groupChannel=e,new q(this.sinch,e)};var G={INITIATING:0,PROGRESSING:1,ESTABLISHED:2,ENDED:3,TRANSFERRING:4},J={NONE:0,TIMEOUT:1,CANCELED:6,DENIED:2,FAILURE:4,HUNG_UP:5,NO_ANSWER:3,OTHER_DEVICE_ANSWERED:7,TIMEOUT:1,TRANSFERRED:8},K=10500,W=45e3,V=function(){};function X(e,t,n){if(!(e instanceof N))throw new SinchError(p,E,"Invalid input to constructor. VerificationClient can not be instantiated, use createSmsVerification in an SinchClient instance",error);if(void 0===t||0==t.toString().length)throw new SinchError(p,E,"Invalid input to constructor. Valid phone number required (E.164 format ideally)",t);this.sinch=e,this.number=t||null,this.custom=n||null,this.flagVerified=!1}function q(e,n){this.sinch=e,this.callClient=e.callClient,this.groupChannel=n,this.eventListeners=[],this.callBuffert=[],this.callListeners={onCallProgressing:function(e){this.sinch.log(new Notification(0,1,"Call progressing",e))}.bind(this),onCallEstablished:function(e){this.sinch.log(new Notification(0,1,"Call established",e)),this.execListener("onGroupRemoteCallAdded",e)}.bind(this),onCallEnded:function(e){this.sinch.log(new Notification(0,1,"Call ended",e)),this.execListener("onGroupRemoteCallRemoved",e)}.bind(this)},this.groupListener={onIncomingCall:function(e){e.addEventListener(this.callListeners),setTimeout(function(){e.answer()},450*Object.keys(this.callBuffert).length+Math.random())}.bind(this)},this.callClient.addEventListener(this.groupListener),this.sinch.callClient.initStream().then(function(e){this.sinch.log(new Notification(0,1,"Media stream successfully created",e)),this.execListener("onGroupLocalMediaAdded",e),this.sinch.mxp.broadcastPubNub.publish({channel:n,message:this.sinch.user.userId}),this.sinch.mxp.subscribeNotificationChannel(n)}.bind(this)),this.sinch.onnotification=function(e,t){n==e&&t!=this.sinch.user.userId&&(this.sinch.log(new Notification(0,1,"Will call user in group, after random timeout",t)),setTimeout(function(){var e=this.callClient.callUser(t);this.callBuffert.push(e),e.addEventListener(this.callListeners)}.bind(this),300+Math.round(500*Math.random())))}.bind(this)}function Q(e,t){if(this.delivered=[],this.direction=!t,e instanceof re){this.messageId=e.mxpSessionId;var n=JSON.parse(e.decrypted.bd);this.textBody=n.t,this.recipientIds=e.recipientIds,this.senderId=e.decrypted.fu;try{this.headers=e.decrypted.nvps.ph}catch(e){}this.timestamp=new Date}else{if(!(e instanceof Object))throw new SinchError(f,x,"Unsupported message parameters",e);this.messageId=O(),this.recipientIds=e.recipientIds,this.textBody=e.textBody,this.senderId=e.senderId,this.headers=e.publicHeaders,this.timestamp=new Date}}function $(e,t){this.messageId=t,this.recipientId=e,this.timestamp=new Date}function Y(e){if(!(e instanceof N))throw new Error("MessageClient can't be instantiated, use getMessageClient in an SinchClient instance");this.sinch=e,this.eventListeners=[],this.messageBuffert={},this.ackBuffert={},this.onMessageDelivered=[],this.emptyLog(),this.messageLogInterval=setInterval(this.commitLog.bind(this),3e4)}function SinchError(e,t,n,i){this.name="SinchError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General sinch error",this.stack=new Error(n).stack}function Z(e){this.userObj={},this.sinch=e}function ee(e,t,n,i){if(!(e instanceof N))throw new SinchError(p,E,"Invalid input to constructor. VerificationClient can not be instantiated, use createSmsVerification in an SinchClient instance",error);if(void 0===t||0==t.toString().length)throw new SinchError(p,E,"Invalid input to constructor. Valid phone number required (E.164 format ideally)",t);this.method=i||"sms",this.sinch=e,this.number=t||null,this.custom=n||null,this.flagVerified=!1}V.generateIceCandidate=function(e,t){return"candidate:"+(""+Math.random()).substring(2,7)+" 1 UDP 2130706431 "+e+" "+t+" typ relay raddr 0.0.0.0 rport 0 generation 0\r\n"},X.prototype.initiate=function(o,a){var c=u.defer();if(this.flagVerified){var e=new SinchError(p,M,"Verification already verified, can't perform another callout.");c.reject(e)}else{var t={identity:{type:"number",endpoint:this.number},custom:this.custom,method:"callout",metadata:{os:A(),platform:P(),sdk:"js/"+this.sinch.getVersion()}};this.sinch.log(new Notification(0,1,"Will initiate callout verification using object",t)),this.sinch.confirmUserCallout(t).then(function(n){var i=this;i.sinch.log(new Notification(0,1,"Successfully initiated callout verification with response",n));var r=0,s=function(){i.sinch.queryVerificationById({number:i.number}).then(function(e){switch(i.sinch.log(new Notification(0,1,"Poll result after "+r+"s",e)),e.status){case"SUCCESSFUL":i.sinch.log(new Notification(0,1,"Successfully verified number after "+r+"s")),o&&o(),c.resolve();break;case"PENDING":if(r+=n.callout.pollingInterval,0<n.callout.pollingInterval&&r<n.callout.stopPollingAfter)window.setTimeout(s,1e3*n.callout.pollingInterval);else{var t=new SinchError(p,B,"Verification Failed, Timeout");a&&a(t),c.reject(t)}break;case"FAIL":case"ERROR":i.sinch.log(new Notification(0,1,"Verification failed after "+r+"s"));t=new SinchError(p,B,"Verification Failed, "+e.reason);a&&a(t),c.reject(t);break;default:i.sinch.log(new Notification(0,1,"Server response not handled at "+r+"s",e))}}).fail(function(e){var t;t=e.status?new SinchError(p,k,"Could not poll verification status: "+e.statusText,e.responseText):e,this.sinch.log(t),a&&a(t),c.reject(t)})};window.setTimeout(s,1e3*n.callout.startPollingAfter)}.bind(this)).fail(function(e){var t;t=e.status?new SinchError(p,k,"Could not request verification: "+e.statusText,e.responseText):e,this.sinch.log(t),a&&a(t),c.reject(t)}.bind(this))}return c.promise},q.prototype.addEventListener=function(e){this.eventListeners.push(e)},q.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},q.prototype.execListener=function(t,n){var i=0;return this.eventListeners.forEach(function(e){return i++,e[t]&&e[t](n)}.bind(this)),i},q.prototype.hangupGroup=function(){if(void 0===this.callClient.groupChannel)throw new SinchError(f,I,"Can not leave room, not in a room");for(var e in this.callBuffert)this.callBuffert[e].hangup();this.callClient.removeEventListener(this.groupListener),this.callClient.groupChannel=void 0},Q.prototype.getMXPMessageObj=function(){var e=new re;return e.mxpSessionId=this.messageId,e.decrypted={bd:JSON.stringify({t:this.textBody})},this.headers&&(e.decrypted.nvps={ph:this.headers}),e.recipientIds=this.recipientIds,e},Y.prototype.emptyLog=function(){this.logCounters={version:"2.0",sent:0,received:0,failed:0}},Y.prototype.commitLog=function(){(this.logCounters.sent||this.logCounters.received||this.logCounters.failed)&&(this.sinch.log(new Notification(0,1,"Will post IM log to backend for statistics",this.logCounters)),this.sinch.messageReporting(this.logCounters).then(this.emptyLog.bind(this)))},Y.prototype.destroy=function(){this.commitLog(),clearInterval(this.messageLogInterval)},Y.prototype.handleMessage=function(e){var t;e.recipientIds=e.transportObj.participants.reduce(function(e,t){return e.push(t.destination.identity),e}.bind(this),[]);var n=!1;return this.messageBuffert[e.mxpSessionId]?t=this.messageBuffert[e.mxpSessionId]:(t=new Q(e,e.decrypted.fu!=this.sinch.user.userId),this.messageBuffert[t.messageId]=t,n=!0),!t.passedToHandler&&(this.eventListeners.forEach(function(e){return t.passedToHandler=!0,e.onIncomingMessage&&e.onIncomingMessage(t)}),n&&this.ackBuffert[t.messageId]&&(this.ackBuffert[t.messageId].forEach(function(e){this.ackMsg(e,t.messageId)}.bind(this)),delete this.ackBuffert[t.messageId]),t.direction||this.logCounters.received++,!0)},Y.prototype.addEventListener=function(e){this.eventListeners.push(e)},Y.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},Y.prototype.send=function(e,t,n){var i=u.defer();if(this.sinch.log(new Notification(0,1,"Send message method called"),i),!(e instanceof Q))throw new SinchError(f,x,"Unsupported message parameters",e);return t=t||function(e){return e},n=n||function(e){console.error(e)},u.fcall(function(e){if(void 0===this.sinch.mxp){var t=new SinchError(f,S,"Sinch is not ready yet");throw i.reject(t),t}if(e.sent)throw new SinchError(f,S,"Message already sent");return e.sent=!0,e}.bind(this),e).then(this.sinch.mxp.sendMessage.bind(this.sinch.mxp)).then(t).then(function(){this.logCounters.sent++}.bind(this)).then(i.resolve).fail(function(e){this.sinch.log(e),n(e),this.logCounters.failed++,i.reject(e)}.bind(this)).progress(function(e){this.sinch.log(e),i.notify(e)}.bind(this)),i.promise},Y.prototype.ackMsg=function(t,n){this.messageBuffert[n]&&-1===this.messageBuffert[n].delivered.indexOf(t)?(this.sinch.log(new MXPLog("Recieved ack from "+t+" for message",n)),this.messageBuffert[n].delivered.push(t),this.eventListeners.forEach(function(e){return e.onMessageDelivered&&e.onMessageDelivered(new $(t,n))}.bind(this))):(this.ackBuffert[n]||(this.ackBuffert[n]=[]),this.ackBuffert[n].push(t),this.sinch.log(new MXPLog("Got ack for message with non-existing messageId, storing in ackBuffert",n)))},Y.prototype.newMessage=function(e,t,n){if("string"==typeof e&&(e=[e]),"string"!=typeof t)throw new SinchError(f,S,"Message text must be a string (for cross device compatability). Please stringify any objects.");if(n&&"string"!=typeof n)throw new SinchError(f,S,"Headers must be a string (for cross device compatability). Please stringify any objects.");return new Q({recipientIds:e,textBody:t,senderId:this.sinch.user.userId,publicHeaders:n})},SinchError.prototype=Error.prototype,Z.prototype.updateUser=function(e){var t=u.defer();return this.sinch.updateUser(e).then(function(e){this.userObj=e,t.resolve(e)}.bind(this)).fail(function(e){t.reject(e)}.bind(this)),t.promise},Z.prototype.create=function(e){var t=u.defer(),n={password:e.password,identities:[]};return e.email&&(n.profile={contact:{email:e.email}},n.identities.push({type:"email",endpoint:e.email})),e.username&&n.identities.push({type:"username",endpoint:e.username}),e.number&&n.identities.push({type:"number",endpoint:e.number}),this.sinch.createUser(n).then(function(e){this.userObj=e,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve(e)}.bind(this)).fail(function(e){t.reject(new SinchError(h,b,e.data.errorCode+" "+e.data.message,e.data))}),t.promise},Z.prototype.authenticate=function(e){if("object"!=typeof e)throw new SinchError(f,x,'No valid identity or authentication ticket. If you are passing your own authentication tickets, ensure it is an object on the format {"userTicket":SOME_TICKET}',e);if(e.expiresIn=e.expiresIn||86400,e.sessionId&&e.sessionSecret)return e;var t=u.defer(),n="";if(this.sinch._appSecret)e=s(this.sinch._appKey,this.sinch._appSecret,e);else if("email"in e){if(n=this.sinch.authenticate,""==e.email)return t.reject(new SinchError(f,x,"Email is empty",e)),t.promise}else if("username"in e){if(n=this.sinch.authenticateUsername,""==e.username)return t.reject(new SinchError(f,x,"Username is empty",e)),t.promise}else if("number"in e&&(n=this.sinch.authenticateNumber,""==e.number))return t.reject(new SinchError(f,x,"Number is empty",e)),t.promise;if(e.authorization||e.userTicket){if(e.userTicket&&!e.user){var i=e.userTicket.split(":"),r=JSON.parse(atob(i[0]));"username"===!r.identity.type&&t.reject(new SinchError(f,x,"Username missing in userTicket JSON object.",e)),e.user={identities:[r.identity]}}this.userObj=e,this.userObj.authorization=e.authorization||e.userTicket,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve()}else n?n(e).then(function(e){this.userObj=e,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve()}.bind(this)).fail(function(e){t.reject(new SinchError(h,b,e.data.errorCode+" "+e.data.message,e.data))}):t.reject(new SinchError(f,x,"No valid identity or authentication ticket",e));return t.promise},Z.prototype.initSessKeySecret=function(){var t=u.defer(),e={};e.version={os:A()||"unknown",platform:P()||"unknown",sdk:"js/"+this.sinch.getVersion()},e.services={calling:[]},this.sinch._onlineCapability&&e.services.calling.push("online"),this.sinch.capabilities.messaging&&e.services.calling.push("im"),this.sinch.capabilities.calling&&(e.services.calling.push("voip"),e.services.calling.push("p2p"),e.services.calling.push("srtp")),e.authorization=this.userObj.authorization;var n=""!==this.sinch._sessionId;return n&&(e.instanceId=this.sinch._sessionId),e.expiresIn=31536e3,this.sinch[n?"renewSecret":"getInstance"](e).then(function(e){this.sinch.config({sessionId:e.id,sessionSecret:e.secret}),t.resolve()}.bind(this)).fail(function(e){this.sinch._sessionId="",this.sinch._sessionSecret="",t.reject(new SinchError(h,b,e.data.errorCode+" "+e.data.message,e.data))}.bind(this)),t.promise},Z.prototype.resumeSession=function(e){var t=u.defer();return this.userId=e.userId,this.sinch.config(e),this.sinch.getUserProfile().then(function(e){this.userObj=e,t.resolve()}.bind(this)).fail(function(e){e instanceof SinchError?t.reject(e):t.reject(new SinchError(h,b,e.data.errorCode+" "+e.data.message,e.data))}),t.promise},Z.prototype.getMXPConf=function(){var t=u.defer();return this.sinch.getConfiguration().then(function(e){this.mxpConfig=e,t.resolve()}.bind(this)).fail(function(e){t.reject(new SinchError(h,b,e.data.errorCode+" "+e.data.message,e.data))}),t.promise},ee.prototype.request=function(t,n){var i=u.defer();if(this.flagVerified){var e=new SinchError(p,M,"Verification already verified, can't request new code.");i.reject(e)}else{var r={identity:{type:"number",endpoint:this.number},custom:this.custom,method:this.method,metadata:{os:A(),platform:P(),sdk:"js/"+this.sinch.getVersion()}};this.sinch.verify(r).then(function(e){t&&t(),i.resolve()}.bind(this)).fail(function(e){var t;t=e.status?new SinchError(p,k,"Could not request verification: "+e.statusText,e.responseText):e,n&&n(t),i.reject(t)}.bind(this))}return i.promise},ee.prototype.verify=function(e,t,n){var i=u.defer();if(this.flagVerified)t&&t(this.cachedResponse),i.resolve(this.cachedResponse);else{var r={number:this.number,source:"manual",sms:"sms"==this.method?{code:e}:null,flashcall:"flashcall"==this.method?{cli:e}:null,method:this.method||"sms"};this.sinch.confirmVerification(r).then(function(e){this.flagVerified=!0,this.cachedResponse=e,t&&t(e),i.resolve(e)}.bind(this)).fail(function(e){var t;t=e.status?new SinchError(p,B,"Could not verify code: "+e.statusText,e.responseText):e,n&&n(t),i.reject(t)}.bind(this))}return i.promise},ee.prototype.initiate=function(e,t){return this.request(e,t)},ee.prototype.retry=function(e,t){return this.request(e,t)};var te=function(t){var e=t.key,n=t.decrypted;t.mxpSessionId;try{var i=he.enc.Utf8.parse(JSON.stringify(n));e=he.enc.Base64.parse(e);var r=he.lib.WordArray.random(16),s=he.AES.encrypt(i,e,{iv:r}),o=he.enc.Hex.parse(r.toString(he.enc.Hex)+s.ciphertext.toString(he.enc.Hex))}catch(e){throw e.message=t.message,new ie(l,w,"MXPEncrypt error: "+e.message,e)}return t.encrypted=o.toString(he.enc.Base64),t},ne=function(t){try{var e=t.key,n=t.message.split(" ")[5],i=he.enc.Base64.parse(n).toString(he.enc.Hex),r=he.enc.Hex.parse(i.substr(0,32)),s=he.enc.Hex.parse(i.substr(32)),o=he.lib.CipherParams.create({ciphertext:s,salt:null}),a=he.AES.decrypt(o,he.enc.Base64.parse(e),{iv:r}).toString(he.enc.Utf8),c=a.indexOf("{"),u=a.lastIndexOf("}")+1;a=a.substring(c,u),t.decrypted=JSON.parse(a)}catch(e){throw e.message=t.message,new ie(l,w,"MXPDecrypt error: "+e.message,e)}return t};function ie(e,t,n,i){this.name="MXPError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General MXP error",this.stack=new Error(n).stack}function re(e,t,n){for(var i in this.decrypted={},e)if("object"==typeof e[i])for(var r in e[i]instanceof Array?this[i]=[]:this[i]={},e[i])this[i][r]=e[i][r];else this[i]=e[i];if(t instanceof U){for(var s in t.activeInstance&&n&&(this.decrypted.nvps=this.decrypted.nvps||{},this.decrypted.nvps.to=t.activeInstance),this.txChannels=[],t.clientMap)"virtual"!=s&&-1===this.txChannels.indexOf(t.clientMap[s].fs)&&this.txChannels.push(t.clientMap[s].fs);0==this.txChannels.length&&"virtual"in t.clientMap&&this.txChannels.push(t.clientMap.virtual.fs),this.sub="signalPubNub"}}function se(e){this.sinch=e,this.user=e.user,this.rtcConfiguration=e.user.mxpConfig.rtcConfiguration,this.rtcProfile=e.user.mxpConfig.rtcProfile,this.broadcastPubNub=PUBNUB({publish_key:this.rtcConfiguration.broadcastNetwork.publishKey,subscribe_key:this.rtcConfiguration.broadcastNetwork.subscribeKey,ssl:!0,origin:this.rtcConfiguration.broadcastNetwork.host}),this.signalPubNub=PUBNUB({publish_key:this.rtcConfiguration.signalNetwork.publishKey,subscribe_key:this.rtcConfiguration.signalNetwork.subscribeKey,ssl:!0,origin:this.rtcConfiguration.signalNetwork.host}),this.messageBuffert={},this.transportBuffert={},this.sessionBuffert={},this.unencryptedFrames={},this.broadcastPubNub.sinchStack={},this.broadcastPubNub.sinchStack[this.rtcProfile.broadcastChannel]=[],this.broadcastPubNub.sinchStack[this.rtcProfile.transportChannel]=[],this.signalPubNub.sinchStack={},this.signalPubNub.sinchStack[this.rtcProfile.signalChannel]=[]}function MXPError(e,t,n,i){this.name="MXPError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General MXP error",this.stack=new Error(n).stack}function MXPLog(e,t){this.message=e,this.object=t}function MXPIncoming(e,t){this.handler=e,this.object=t}function MXPOutgoing(e,t){this.handler=e,this.object=t}re.prototype.getSenderId=function(){if(void 0===this.decrypted.fi)throw new SinchError(f,_,"getSenderId failed, no from instance defined",{});return this.decrypted.fsi?this.decrypted.fi+this.decrypted.fsi||"virtual":(this.decrypted.nvps||{}).fsi?this.decrypted.fi+this.decrypted.nvps.fsi||"virtual":this.decrypted.fi||"virtual"},re.prototype.getFrom=function(){return{fc:this.decrypted.fc,fd:this.decrypted.fd,fi:this.decrypted.fi,fsi:this.decrypted.fsi,fs:this.decrypted.fs,fu:this.decrypted.fu}},re.prototype.getInstanceId=function(){return this.decrypted.fi?this.decrypted.fi.split(":")[0]:null},se.prototype.init=function(){return this.subscribe("broadcastPubNub")},se.prototype.close=function(){var e=this.broadcastPubNub,t=this.signalPubNub;return setTimeout(function(){e&&e.offline(),t&&t.offline()}.bind(this),1e4),u.all([this.unsubscribe("broadcastPubNub"),this.unsubscribe("signalPubNub")])},se.prototype.destroy=function(){delete this.broadcastPubNub,delete this.signalPubNub},se.prototype.subscribe=function(e){var t=u.defer(),n={restore:!1,connect:function(e){t.resolve()}.bind(this),channel:Object.keys(this[e].sinchStack),callback:this._onmessagePubNub.bind(this),disconnect:this._ondisconnectPubNub.bind(this),error:this._onerrorPubNub.bind(this)},i=!0;for(var r in this[e].sinchStack)i&=0==this[e].sinchStack[r].length,this[e].sinchStack[r].push(!0);return i?this[e].subscribe(n):t.resolve(),t.promise},se.prototype.subscribeNotificationChannel=function(t){var n=u.defer(),e="broadcastPubNub",i={restore:!(this[e].sinchStack[t]=[]),connect:function(e){n.resolve()}.bind(this),channel:t,callback:function(e){this.sinch.onnotification(t,e)}.bind(this),disconnect:this._ondisconnectPubNub.bind(this),error:this._onerrorPubNub.bind(this)};return this[e].subscribe(i),n.promise},se.prototype.unsubscribe=function(e){var t=!0;for(var n in this[e].sinchStack)this[e].sinchStack[n].pop(),t&=0==this[e].sinchStack[n].length;t&&this[e].unsubscribe({channel:Object.keys(this[e].sinchStack)})},se.prototype.signalStatus=function(){return 0<this.signalPubNub.sinchStack[this.rtcProfile.signalChannel].length},se.prototype._onmessagePubNub=function(n){this.sinch.log(new MXPLog("Recieved message",n)),u.fcall(this.collectFrames.bind(this),n).then(this.identifyKey.bind(this)).then(ne).then(this.handleMessage.bind(this)).fail(function(e){if(e instanceof ie){var t=n.split(" ")[1];this.unencryptedFrames[t]=this.unencryptedFrames[t]||[],this.unencryptedFrames[t].push(e.response.message)}else this.handleError(e)}.bind(this))},se.prototype.configureMxpSession=function(e,t,n){this.sessionBuffert[e]={key:t,body:n},this.processUnencryptedForKey(e)},se.prototype.processUnencryptedForKey=function(e){for(var t in this.unencryptedFrames[e])this._onmessagePubNub(this.unencryptedFrames[e][t]),delete this.unencryptedFrames[e][t]},se.prototype._ondisconnectPubNub=function(e){this.sinch.log(new MXPLog("Was disconnected!",e))},se.prototype._onerrorPubNub=function(e){var t=new MXPError(o,d,"PubNub error",e);this.sinch.log(t)},se.prototype.collectFrames=function(e){var t=u.defer(),n=e.split(" "),i=n[1]+n[2];try{n[3]=parseInt(n[3]),n[4]=parseInt(n[4])}catch(e){console.error("Could not parse MXP indices. Malformatted MXP message.")}if(1===n[4])t.resolve(e);else if((this.messageBuffert[i]||(this.messageBuffert[i]={}))[n[3]]=n[5],Object.keys(this.messageBuffert[i]).length==n[4]){var r=n[0]+" "+n[1]+" "+n[2]+" 0 1 ";for(var s in this.messageBuffert[i])r+=this.messageBuffert[i][s];void 0!==n[6]&&(r+=" "+n[6]),this.sinch.log(new MXPLog("All frames collected and merged, full array",this.messageBuffert[i])),delete this.messageBuffert[i],t.resolve(r)}else t.reject(new MXPLog("All frames not yet gathered",this.messageBuffert[i]));return t.promise},se.prototype.identifyKey=function(t){this.sinch.log(new MXPLog("Will identify key",t));var n,i=u.defer(),r=t.trim().split(" ");return void 0!==(n=r[6])?(this.sinch.log(new MXPLog("Transport key identified",t)),this.getTransport(n).then(function(e){i.resolve(new re({mxpSessionId:r[1],message:t,transportId:n,transportObj:e,key:this.transportBuffert[n].key,keyType:"T"}))}.bind(this)).fail(function(e){i.reject(e)}.bind(this))):void 0!==(this.sessionBuffert[r[1]]||{}).key?(this.sinch.log(new MXPLog("Session key in buffert identified",t)),i.resolve(new re({mxpSessionId:r[1],message:t,key:this.sessionBuffert[r[1]].key,keyType:"S"}))):(this.sinch.log(new MXPLog("No key, fall back on instance key",t)),i.resolve(new re({mxpSessionId:r[1],message:t,key:this.rtcProfile.key,keyType:"I"}))),i.promise},se.prototype.handleMessage=function(e){this.sinch.log(new MXPLog("Will handle message",e));var t=u.defer(),n=e.decrypted.md+"_"+(e.decrypted.bt||"null");return this.sinch.logMxp(new MXPIncoming(n,e)),ae[n]?ae[n].call(this,e):t.reject(new MXPError(l,w,"Handler not implemented: "+n,{})),t.promise},se.prototype.handleError=function(e){this.sinch.log(e),e.stack&&console.error(e.stack)},se.prototype.getTransport=function(r){var s=u.defer();if(r.constructor==String){var t=r;void 0!==this.transportBuffert[t]?(this.sinch.log(new MXPLog("Got transport from Buffert",this.transportBuffert[t])),s.resolve(this.transportBuffert[t])):this.sinch.getTransportById({transportId:t}).then(function(e){this.sinch.log(new MXPLog("Got new transport",e)),this.transportBuffert[t]=e,s.resolve(this.transportBuffert[t])}.bind(this))}else{if(r instanceof re||r instanceof Array){var o=r instanceof re?r.recipientIds:r,e=(o=o.filter(function(e,t,n){return n.indexOf(e)===t})).indexOf(this.user.userId);-1<e&&o.splice(e,1);var n=[];o.forEach(function(e){if("string"==typeof e)n.push({identity:e});else if(e instanceof Object)for(var t in e)n.push({identity:e[t],type:t})}),o.push(this.user.userId),o=o.sort();var a=btoa(JSON.stringify(o));if(this.transportBuffert[a]){var i=this.transportBuffert[a];this.sinch.log(new MXPLog("Got cached transport for recipient(s)",i)),r instanceof re?(r.transportObj=i,r.transportId=r.transportObj.transportId,s.resolve(r)):s.resolve(i)}else this.sinch.getTransportByParticipants(n).then(function(e){e.participants.forEach(function(n){n.capabilityUnion=[],(n.instances||[]).forEach(function(e){n.capabilityUnion=n.capabilityUnion.concat(e.capabilities)}),n.capabilityUnion=n.capabilityUnion.filter(function(e,t){return n.capabilityUnion.indexOf(e)==t})});var t=[];if(e.participants.forEach(function(e){-1===e.capabilityUnion.indexOf("im")&&-1===e.capabilityUnion.indexOf("im.1")&&t.push(e.destination.identity)}),0<t.length)throw new SinchError(c,m,"User missing capability",t);e.participants.unshift({channel:this.rtcProfile.transportChannel,destination:{identity:this.user.userId}});var n=e.participants.reduce(function(e,t){return e.push(t.destination.identity),e}.bind(this),[]),i=o.filter(function(e){return n.indexOf(e)<0});if(o.length!=e.participants.length)throw new MXPError(c,y,"User does not exist",i);this.sinch.log(new MXPLog("Got new transport for recipient(s)",e)),this.transportBuffert[a]=e,r instanceof re?(r.transportObj=e,r.transportId=r.transportObj.transportId,s.resolve(r)):s.resolve(e)}.bind(this)).fail(function(e){s.reject(e)});return s.promise}s.reject(new MXPError(l,w,"Unknown transport ID",t))}return s.promise},se.prototype.sendMXP=function(e){var t=u.defer();return e.sub=e.sub||"broadcastPubNub",u.fcall(this.constructMXP.bind(this),e).then(this.identifyEnKey.bind(this)).then(te).then(this.splitFrames.bind(this)).then(this.getTxChannels.bind(this)).then(this.transmitFrames.bind(this)).then(function(e){t.resolve(e)}).fail(function(e){console.error(e.stack),console.error(e),t.reject(e)}).progress(function(e){t.notify(e)}),t.promise},se.prototype.constructMXP=function(e){return e.decrypted.fu=this.user.userId,e.decrypted.fi=this.sinch._sessionId+":"+this.sinch._subInstanceId,e.decrypted.fd=this.sinch._sessionId,e.decrypted.fc="",this.sinch.log(new MXPLog("Added meta data to MXP message",e)),e},se.prototype.identifyEnKey=function(e){return e.transportObj?(e.transportId=e.transportObj.transportId,e.key=e.transportObj.key,e.keyType="T",e.decrypted.fs=this.rtcProfile.transportChannel):(e.key=this.sessionBuffert[e.mxpSessionId].key,e.keyType="S",e.decrypted.fs=this.rtcProfile.signalChannel),this.sinch.log(new MXPLog("Identified Encoding Key",e)),e},se.prototype.splitFrames=function(e){e.encodedFrames=[];var t=1500;for(t-=e.mxpSessionId.length,t-=(e.transportId||"").length,t-=9,t-=6;e.encodedFrames.push(e.encrypted.slice(0,t)),e.encrypted=e.encrypted.substring(t),0<e.encrypted.length;);var n=Math.floor(2e9*Math.random());for(var i in e.encodedFrames)e.encodedFrames[i]="10 "+e.mxpSessionId+" "+(1<e.encodedFrames.length?n:"-")+" "+i+" "+e.encodedFrames.length+" "+e.encodedFrames[i],e.transportId&&(e.encodedFrames[i]+=" "+e.transportId);return this.sinch.log(new MXPLog("Split message into frames as needed",e)),e},se.prototype.getTxChannels=function(t){return t.txChannels=t.txChannels||[],t.transportObj&&t.transportObj.participants.forEach(function(e){t.txChannels.push(e.channel)}),this.sinch.log(new MXPLog("Identified Tx Channels",t)),t},se.prototype.transmitFrames=function(n){var i=u.defer();this.sinch.logMxp(new MXPOutgoing(n.decrypted.md+"_"+(n.decrypted.bt||"null"),n));var r,s=[];return r=n.transportObj?n.transportObj.participants.length*n.encodedFrames.length:n.encodedFrames.length,s.length==r&&i.resolve(n),n.txChannels.forEach(function(t){n.encodedFrames.forEach(function(e){this.sinch.log(new MXPLog("Transmitting [channel, frame]",[t,e])),this[n.sub].publish({channel:t,message:e,callback:function(e){s.push(e),i.notify(new Notification(s.length,r,"MXP Message send progress (frame Tx)")),s.length==r&&setTimeout(function(){i.resolve(n)},1e3)},error:function(e){console.error("PubNub: Error sending frame",e),i.reject(new MXPError(l,w,"PubNub: Error sending frame",e))}})}.bind(this))}.bind(this)),i.promise},MXPError.prototype=Error.prototype;se.prototype.joinIncomingCall=function(e,t){var n=u.defer(),i=new re({mxpSessionId:e.callId},e,!0);return i.decrypted.bd=t||null,i.decrypted.md=3,i.decrypted.bt=t?"media":"sdp",i.decrypted.bv=10,this.sendMXP(i).then(function(){n.resolve()}).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},se.prototype.callJoined=function(e){var t=u.defer(),n=new re({mxpSessionId:e.callId},e);return n.decrypted.bd=JSON.stringify(e.clientMap[e.activeInstance]),n.decrypted.md=4,n.decrypted.bt="client",n.decrypted.bv=10,n.decrypted.nvps&&delete n.decrypted.nvps.to,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},se.prototype.sendSdpAnswer=function(e,t){var n=u.defer(),i=new re({mxpSessionId:e.callId},e);return i.decrypted.bd=t?JSON.stringify(t):null,i.decrypted.md=2,i.decrypted.bt=t?"sdp":null,i.decrypted.bv=10,this.sendMXP(i).then(function(){n.resolve()}).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},se.prototype.callHangup=function(e){var t=u.defer(),n=new re({mxpSessionId:e.callId},e);return n.decrypted.md=5,n.decrypted.bv=10,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},se.prototype.callDeny=function(e){var t=u.defer(),n=new re({mxpSessionId:e.callId},e);return n.decrypted.md=6,n.decrypted.bv=10,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},se.prototype.callCancel=function(e){var t=u.defer(),n=new re({mxpSessionId:e.callId},e);return n.decrypted.md=7,n.decrypted.bv=10,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},se.prototype.callTxICECandidate=function(e,t,n){var i=u.defer(),r=new re({mxpSessionId:e.callId},e);return r.decrypted.bd=JSON.stringify(t),r.decrypted.md=10,r.decrypted.bt="sdp",r.decrypted.bv=10,n&&(r.decrypted.nvps=r.decrypted.nvps||{},r.decrypted.nvps.to=n||"undefined"),this.sendMXP(r).then(function(){i.resolve()}).fail(function(e){i.reject(e)}).progress(function(e){i.notify(e)}.bind(this)),i.promise},se.prototype.callTxPeerEventSDP=function(e,t,n){var i=u.defer(),r=new re({mxpSessionId:e.callId},e);return r.decrypted.bd=JSON.stringify(t),r.decrypted.md=10,r.decrypted.bt="sdp",r.decrypted.bv=10,r.decrypted.nvps=r.decrypted.nvps||{},r.decrypted.nvps.to=n||"undefined",this.sendMXP(r).then(function(){i.resolve()}).fail(function(e){i.reject(e)}).progress(function(e){i.notify(e)}.bind(this)),i.promise},se.prototype.msgToMe=function(e){return!e.decrypted.nvps||!e.decrypted.nvps.to||e.decrypted.nvps.to==this.sinch._sessionId+":"+this.sinch._subInstanceId},se.prototype.msgToMe2=function(e){return!e.decrypted.nvps||!e.decrypted.nvps.to||e.decrypted.nvps.to==this.sinch._sessionId};var oe={"1_media":function(e){this.msgToMe2(e)?(function(){if(void 0===this.sinch.callClient){var e=new MXPError(c,m,"Can not process call signal messages. Call capability not set.");this.sinch.log(e)}}.call(this),this.sinch.callClient&&this.sinch.callClient.handleIncomingCall(e)):this.sinch.log(new Notification(0,1,"Received INVITE message not meant for this instance, nvps.to header set to foreign instance id",e))},"2_null":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"2_media":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"2_sdp":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"3_media":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoin(e)},"3_sdp":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoin(e)},"4_client":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoined(e)},"5_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpHangup(e):this.sinch.log(new Notification(0,1,"Received HUNG_UP message not meant for this instance, nvps.to header set to foreign instance id",e))},"6_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpDeny(e):this.sinch.callClient&&this.sinch.log(new Notification(0,1,"Received DENIED message not meant for this instance, nvps.to header set to foreign instance id",e))},"6_error/json":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpDeny(e):this.sinch.callClient&&this.sinch.log(new Notification(0,1,"Received DENIED message not meant for this instance, nvps.to header set to foreign instance id",e))},"7_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpCancel(e):this.sinch.log(new Notification(0,1,"Received CANCEL message not meant for this instance, nvps.to header set to foreign instance id",e))},"7_client":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpCancel(e):this.sinch.log(new Notification(0,1,"Received CANCEL message not meant for this instance, nvps.to header set to foreign instance id",e))},"9_message":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpFail(e)},"9_error/json":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpFail(e)},"10_sdp":function(e){if(this.msgToMe(e)){var t=JSON.parse(e.decrypted.bd);"type"in t&&"offer"==t.type||"answer"==t.type?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpPeerEventSdp(e):this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpInjectIce(e)}else this.sinch.log(new Notification(0,1,"Received SDP/CAND message not meant for this instance, nvps.to header set to foreign instance id",e))}},ae=ae||{};for(var ce in oe)ae[ce]=oe[ce];se.prototype.sendMessage=function(e){var t=e.getMXPMessageObj(),n=u.defer();return t.decrypted.md=1,t.decrypted.bt="msg",t.decrypted.bv=10,this.getTransport(t).then(this.sendMXP.bind(this)).then(function(e){ae["1_msg"].call(this,e),this.sinch.log(new MXPLog("Message sent to all participants",e)),n.resolve(this.sinch.messageClient.messageBuffert[e.mxpSessionId])}.bind(this)).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},se.prototype.sendMsgAck=function(t){var e=new re({mxpSessionId:t.mxpSessionId});e.decrypted.md=2,e.decrypted.bt=t.decrypted.bt,e.decrypted.bv=10,e.transportObj=t.transportObj;var n=[];e.transportObj.participants.forEach(function(e){e.channel==t.decrypted.fs&&n.push(e)}.bind(this)),e.transportObj.participants=n,0<Object.keys(e.transportObj.participants).length&&(this.sinch.log(new MXPLog("Will send Ack",e)),this.sendMXP(e).then(function(e){this.sinch.log(new MXPLog("Sent ack",[t.decrypted.fu,e.channel]))}.bind(this)).fail(function(e){console.error(e)}))};var ue={none:function(e){console.log("Null handler for message object: ",e)},"1_msg":function(e){(function(){if(void 0===this.sinch.messageClient){var e=new MXPError(c,m,"Can not process IM messages. Messaging capability not set.");this.sinch.log(e)}}).call(this),this.sinch.messageClient&&this.sinch.messageClient.handleMessage(e)&&e.decrypted.fu!=this.user.userId&&this.sendMsgAck(e)},"2_msg":function(e){this.sinch.messageClient&&this.sinch.messageClient.ackMsg(e.decrypted.fu,e.mxpSessionId)}};ae=ae||{};for(var ce in ue)ae[ce]=ue[ce];var he=he||function(a,e){var t={},n=t.lib={},i=function(){},r=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,r=this.blockSize,s=i/(4*r);if(e=(s=e?a.ceil(s):a.max((0|s)-this._minBufferSize,0))*r,i=a.min(4*e,i),e){for(var o=0;o<e;o+=r)this._doProcessBlock(n,o);o=n.splice(0,e),t.sigBytes-=i}return new c.init(o,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new f.HMAC.init(n,t).finalize(e)}}});var f=t.algo={};return t}(Math);!function(s){function I(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function x(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function C(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function E(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var e=he,t=(i=e.lib).WordArray,n=i.Hasher,i=e.algo,k=[],r=0;r<64;r++)k[r]=4294967296*s.abs(s.sin(r+1))|0;i=i.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=e[o=t+n];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}n=this._hash.words;var r,s,o=e[t+0],a=(i=e[t+1],e[t+2]),c=e[t+3],u=e[t+4],h=e[t+5],l=e[t+6],f=e[t+7],p=e[t+8],d=e[t+9],g=e[t+10],y=e[t+11],m=e[t+12],v=e[t+13],b=e[t+14],w=e[t+15],S=n[0],_=E(_=E(_=E(_=E(_=C(_=C(_=C(_=C(_=x(_=x(_=x(_=x(_=I(_=I(_=I(_=I(_=n[1],s=I(s=n[2],r=I(r=n[3],S=I(S,_,s,r,o,7,k[0]),_,s,i,12,k[1]),S,_,a,17,k[2]),r,S,c,22,k[3]),s=I(s,r=I(r,S=I(S,_,s,r,u,7,k[4]),_,s,h,12,k[5]),S,_,l,17,k[6]),r,S,f,22,k[7]),s=I(s,r=I(r,S=I(S,_,s,r,p,7,k[8]),_,s,d,12,k[9]),S,_,g,17,k[10]),r,S,y,22,k[11]),s=I(s,r=I(r,S=I(S,_,s,r,m,7,k[12]),_,s,v,12,k[13]),S,_,b,17,k[14]),r,S,w,22,k[15]),s=x(s,r=x(r,S=x(S,_,s,r,i,5,k[16]),_,s,l,9,k[17]),S,_,y,14,k[18]),r,S,o,20,k[19]),s=x(s,r=x(r,S=x(S,_,s,r,h,5,k[20]),_,s,g,9,k[21]),S,_,w,14,k[22]),r,S,u,20,k[23]),s=x(s,r=x(r,S=x(S,_,s,r,d,5,k[24]),_,s,b,9,k[25]),S,_,c,14,k[26]),r,S,p,20,k[27]),s=x(s,r=x(r,S=x(S,_,s,r,v,5,k[28]),_,s,a,9,k[29]),S,_,f,14,k[30]),r,S,m,20,k[31]),s=C(s,r=C(r,S=C(S,_,s,r,h,4,k[32]),_,s,p,11,k[33]),S,_,y,16,k[34]),r,S,b,23,k[35]),s=C(s,r=C(r,S=C(S,_,s,r,i,4,k[36]),_,s,u,11,k[37]),S,_,f,16,k[38]),r,S,g,23,k[39]),s=C(s,r=C(r,S=C(S,_,s,r,v,4,k[40]),_,s,o,11,k[41]),S,_,c,16,k[42]),r,S,l,23,k[43]),s=C(s,r=C(r,S=C(S,_,s,r,d,4,k[44]),_,s,m,11,k[45]),S,_,w,16,k[46]),r,S,a,23,k[47]),s=E(s,r=E(r,S=E(S,_,s,r,o,6,k[48]),_,s,f,10,k[49]),S,_,b,15,k[50]),r,S,h,21,k[51]),s=E(s,r=E(r,S=E(S,_,s,r,m,6,k[52]),_,s,c,10,k[53]),S,_,g,15,k[54]),r,S,i,21,k[55]),s=E(s,r=E(r,S=E(S,_,s,r,p,6,k[56]),_,s,w,10,k[57]),S,_,l,15,k[58]),r,S,v,21,k[59]),s=E(s,r=E(r,S=E(S,_,s,r,u,6,k[60]),_,s,y,10,k[61]),S,_,a,15,k[62]),r,S,d,21,k[63]);n[0]=n[0]+S|0,n[1]=n[1]+_|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32;var r=s.floor(n/4294967296);for(t[15+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)i=t[n],t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(i),e.HmacMD5=n._createHmacHelper(i)}(Math);var le,fe,pe,de;he=he||function(a,e){var t={},n=t.lib={},i=function(){},r=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,r=this.blockSize,s=i/(4*r);if(e=(s=e?a.ceil(s):a.max((0|s)-this._minBufferSize,0))*r,i=a.min(4*e,i),e){for(var o=0;o<e;o+=r)this._doProcessBlock(n,o);o=n.splice(0,e),t.sigBytes-=i}return new c.init(o,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new f.HMAC.init(n,t).finalize(e)}}});var f=t.algo={};return t}(Math);!function(r){for(var e=he,t=(i=e.lib).WordArray,n=i.Hasher,i=e.algo,s=[],d=[],o=function(e){return 4294967296*(e-(0|e))|0},a=2,c=0;c<64;){var u;e:{u=a;for(var h=r.sqrt(u),l=2;l<=h;l++)if(!(u%l)){u=!1;break e}u=!0}u&&(c<8&&(s[c]=o(r.pow(a,.5))),d[c]=o(r.pow(a,1/3)),c++),a++}var g=[];i=i.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],u=n[6],h=n[7],l=0;l<64;l++){if(l<16)g[l]=0|e[t+l];else{var f=g[l-15],p=g[l-2];g[l]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+g[l-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+g[l-16]}f=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+d[l]+g[l],p=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),h=u,u=c,c=a,a=o+f|0,o=s,s=r,r=i,i=f+p|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=r.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=n._createHelper(i),e.HmacSHA256=n._createHmacHelper(i)}(Math),fe=(le=he).enc.Utf8,le.algo.HMAC=le.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=fe.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),s=this._iKey=t.clone(),o=r.words,a=s.words,c=0;c<n;c++)o[c]^=1549556828,a[c]^=909522486;r.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),de=(pe=he).lib.WordArray,pe.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;o<4&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return de.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};var ge,ye,me,ve,be,we,Se;he=he||function(a,e){var t={},n=t.lib={},i=function(){},r=n.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),s=t.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,r=this.blockSize,s=i/(4*r);if(e=(s=e?a.ceil(s):a.max((0|s)-this._minBufferSize,0))*r,i=a.min(4*e,i),e){for(var o=0;o<e;o+=r)this._doProcessBlock(n,o);o=n.splice(0,e),t.sigBytes-=i}return new c.init(o,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new f.HMAC.init(n,t).finalize(e)}}});var f=t.algo={};return t}(Math);ye=(ge=he).lib.WordArray,ge.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;o<4&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return ye.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(s){function I(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function x(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function C(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function E(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var e=he,t=(i=e.lib).WordArray,n=i.Hasher,i=e.algo,k=[],r=0;r<64;r++)k[r]=4294967296*s.abs(s.sin(r+1))|0;i=i.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=e[o=t+n];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}n=this._hash.words;var r,s,o=e[t+0],a=(i=e[t+1],e[t+2]),c=e[t+3],u=e[t+4],h=e[t+5],l=e[t+6],f=e[t+7],p=e[t+8],d=e[t+9],g=e[t+10],y=e[t+11],m=e[t+12],v=e[t+13],b=e[t+14],w=e[t+15],S=n[0],_=E(_=E(_=E(_=E(_=C(_=C(_=C(_=C(_=x(_=x(_=x(_=x(_=I(_=I(_=I(_=I(_=n[1],s=I(s=n[2],r=I(r=n[3],S=I(S,_,s,r,o,7,k[0]),_,s,i,12,k[1]),S,_,a,17,k[2]),r,S,c,22,k[3]),s=I(s,r=I(r,S=I(S,_,s,r,u,7,k[4]),_,s,h,12,k[5]),S,_,l,17,k[6]),r,S,f,22,k[7]),s=I(s,r=I(r,S=I(S,_,s,r,p,7,k[8]),_,s,d,12,k[9]),S,_,g,17,k[10]),r,S,y,22,k[11]),s=I(s,r=I(r,S=I(S,_,s,r,m,7,k[12]),_,s,v,12,k[13]),S,_,b,17,k[14]),r,S,w,22,k[15]),s=x(s,r=x(r,S=x(S,_,s,r,i,5,k[16]),_,s,l,9,k[17]),S,_,y,14,k[18]),r,S,o,20,k[19]),s=x(s,r=x(r,S=x(S,_,s,r,h,5,k[20]),_,s,g,9,k[21]),S,_,w,14,k[22]),r,S,u,20,k[23]),s=x(s,r=x(r,S=x(S,_,s,r,d,5,k[24]),_,s,b,9,k[25]),S,_,c,14,k[26]),r,S,p,20,k[27]),s=x(s,r=x(r,S=x(S,_,s,r,v,5,k[28]),_,s,a,9,k[29]),S,_,f,14,k[30]),r,S,m,20,k[31]),s=C(s,r=C(r,S=C(S,_,s,r,h,4,k[32]),_,s,p,11,k[33]),S,_,y,16,k[34]),r,S,b,23,k[35]),s=C(s,r=C(r,S=C(S,_,s,r,i,4,k[36]),_,s,u,11,k[37]),S,_,f,16,k[38]),r,S,g,23,k[39]),s=C(s,r=C(r,S=C(S,_,s,r,v,4,k[40]),_,s,o,11,k[41]),S,_,c,16,k[42]),r,S,l,23,k[43]),s=C(s,r=C(r,S=C(S,_,s,r,d,4,k[44]),_,s,m,11,k[45]),S,_,w,16,k[46]),r,S,a,23,k[47]),s=E(s,r=E(r,S=E(S,_,s,r,o,6,k[48]),_,s,f,10,k[49]),S,_,b,15,k[50]),r,S,h,21,k[51]),s=E(s,r=E(r,S=E(S,_,s,r,m,6,k[52]),_,s,c,10,k[53]),S,_,g,15,k[54]),r,S,i,21,k[55]),s=E(s,r=E(r,S=E(S,_,s,r,p,6,k[56]),_,s,w,10,k[57]),S,_,l,15,k[58]),r,S,v,21,k[59]),s=E(s,r=E(r,S=E(S,_,s,r,u,6,k[60]),_,s,y,10,k[61]),S,_,a,15,k[62]),r,S,d,21,k[63]);n[0]=n[0]+S|0,n[1]=n[1]+_|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32;var r=s.floor(n/4294967296);for(t[15+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)i=t[n],t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(i),e.HmacMD5=n._createHmacHelper(i)}(Math),be=(me=(ve=he).lib).Base,we=me.WordArray,Se=(me=ve.algo).EvpKDF=be.extend({cfg:be.extend({keySize:4,hasher:me.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(o=this.cfg).hasher.create(),i=we.create(),r=i.words,s=o.keySize,o=o.iterations;r.length<s;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<o;c++)a=n.finalize(a),n.reset();i.concat(a)}return i.sigBytes=4*s,i}}),ve.EvpKDF=function(e,t,n){return Se.create(n).compute(e,t)},he.lib.Cipher||function(e){var t=(p=he).lib,n=t.Base,o=t.WordArray,i=t.BufferedBlockAlgorithm,r=p.enc.Base64,s=p.algo.EvpKDF,a=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(i){return{encrypt:function(e,t,n){return("string"==typeof t?d:f).encrypt(i,e,t,n)},decrypt:function(e,t,n){return("string"==typeof t?d:f).decrypt(i,e,t,n)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},u=function(e,t,n){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=i[r]},h=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;u.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=e.slice(t,t+i);n.decryptBlock(e,t),u.call(this,e,t,i),this._prevBlock=r}}),c=c.CBC=h,h=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,r=[],s=0;s<n;s+=4)r.push(i);n=o.create(r,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:h}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(r)},parse:function(e){var t=(e=r.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i);return t=r.finalize(t),r=r.cfg,l.create({ciphertext:t,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=o.random(8)),e=s.create({keySize:t+n}).compute(e,i),n=o.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:i})}},d=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,n,i){return n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,(e=f.encrypt.call(this,e,t,n.key,i)).mixIn(n),e},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt),i.iv=n.iv,f.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=he,t=e.lib.BlockCipher,n=e.algo,o=[],i=[],r=[],s=[],a=[],c=[],u=[],h=[],l=[],f=[],p=[],d=0;d<256;d++)p[d]=d<128?d<<1:d<<1^283;var g=0,y=0;for(d=0;d<256;d++){var m=(m=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&m^99;o[g]=m;var v=p[i[m]=g],b=p[v],w=p[b],S=257*p[m]^16843008*m;r[g]=S<<24|S>>>8,s[g]=S<<16|S>>>16,a[g]=S<<8|S>>>24,c[g]=S,S=16843009*w^65537*b^257*v^16843008*g,u[m]=S<<24|S>>>8,h[m]=S<<16|S>>>16,l[m]=S<<8|S>>>24,f[m]=S,g?(g=v^p[p[p[w^v]]],y^=p[p[y]]):g=y=1}var _=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],r=0;r<n;r++)if(r<t)i[r]=e[r];else{var s=i[r-1];r%t?6<t&&4==r%t&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=_[r/t|0]<<24),i[r]=i[r-t]^s}for(e=this._invKeySchedule=[],t=0;t<n;t++)r=n-t,s=t%4?i[r]:i[r-4],e[t]=t<4||r<=4?s:u[o[s>>>24]]^h[o[s>>>16&255]]^l[o[s>>>8&255]]^f[o[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,s,a,c,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,h,l,f,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,s,o,a){for(var c=this._nRounds,u=e[t]^n[0],h=e[t+1]^n[1],l=e[t+2]^n[2],f=e[t+3]^n[3],p=4,d=1;d<c;d++){var g=i[u>>>24]^r[h>>>16&255]^s[l>>>8&255]^o[255&f]^n[p++],y=i[h>>>24]^r[l>>>16&255]^s[f>>>8&255]^o[255&u]^n[p++],m=i[l>>>24]^r[f>>>16&255]^s[u>>>8&255]^o[255&h]^n[p++];f=i[f>>>24]^r[u>>>16&255]^s[h>>>8&255]^o[255&l]^n[p++],u=g,h=y,l=m}g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&f])^n[p++],y=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^n[p++],m=(a[l>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[p++],f=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[p++],e[t]=g,e[t+1]=y,e[t+2]=m,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),t.exports=N,t.exports.MessageClient=Y,t.exports.Message=Q,t.exports.Call=U,t.exports.CallClient=F,t.exports.Verification=ee,t.exports.CallDetails=z,t.exports.MessageDeliveryInfo=$,t.exports.PAPIDefs=i},{"../VERSION":1,q:13,"sinch-ticketgen":14}]},{},[17])(17)});